<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rource - Software Version Control Visualization</title>
    <meta name="description" content="Visualize your git repository history as an animated tree. Watch your codebase grow as developers collaborate. Runs in your browser with WebAssembly.">
    <meta name="keywords" content="git, visualization, gource, repository, version control, wasm, webassembly, rust">
    <meta name="author" content="Rource Contributors">

    <!-- Open Graph / Social Sharing -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://tomtom215.github.io/rource/">
    <meta property="og:title" content="Rource - Software Version Control Visualization">
    <meta property="og:description" content="Visualize your git repository history as an animated tree. Watch your codebase grow as developers collaborate.">
    <meta property="og:image" content="https://tomtom215.github.io/rource/og-image.png">

    <!-- Twitter Card -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="Rource - Software Version Control Visualization">
    <meta name="twitter:description" content="Visualize your git repository history as an animated tree. Runs entirely in your browser.">

    <!-- Favicon (inline SVG as data URI) -->
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><circle cx='50' cy='50' r='45' fill='%23e94560'/><circle cx='50' cy='30' r='8' fill='white'/><circle cx='30' cy='60' r='6' fill='white'/><circle cx='70' cy='55' r='6' fill='white'/><circle cx='50' cy='75' r='5' fill='white'/><line x1='50' y1='38' x2='50' y2='70' stroke='white' stroke-width='2'/><line x1='50' y1='50' x2='32' y2='58' stroke='white' stroke-width='2'/><line x1='50' y1='50' x2='68' y2='53' stroke='white' stroke-width='2'/></svg>">

    <!-- Theme color for mobile browsers -->
    <meta name="theme-color" content="#1a1a2e">

    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --bg-primary: #0d1117;
            --bg-secondary: #161b22;
            --bg-tertiary: #21262d;
            --bg-canvas: #010409;
            --accent: #e94560;
            --accent-hover: #ff6b6b;
            --accent-secondary: #238636;
            --accent-blue: #58a6ff;
            --text-primary: #f0f6fc;
            --text-secondary: #8b949e;
            --text-muted: #6e7681;
            --border: #30363d;
            --border-light: #484f58;
            --success: #3fb950;
            --error: #f85149;
            --warning: #d29922;
            --shadow: rgba(0, 0, 0, 0.4);
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Noto Sans', Helvetica, Arial, sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            min-height: 100vh;
            line-height: 1.5;
        }

        /* Focus styles for accessibility */
        :focus-visible {
            outline: 2px solid var(--accent-blue);
            outline-offset: 2px;
        }

        a {
            color: var(--accent-blue);
            text-decoration: none;
        }

        a:hover {
            text-decoration: underline;
        }

        /* Skip to content link */
        .skip-link {
            position: absolute;
            top: -40px;
            left: 0;
            background: var(--accent);
            color: white;
            padding: 8px 16px;
            z-index: 1000;
            text-decoration: none;
            border-radius: 0 0 4px 0;
        }

        .skip-link:focus {
            top: 0;
        }

        /* Header */
        header {
            background: var(--bg-secondary);
            padding: 0.75rem 1.5rem;
            display: flex;
            align-items: center;
            justify-content: space-between;
            border-bottom: 1px solid var(--border);
            flex-wrap: wrap;
            gap: 0.75rem;
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .header-brand {
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .header-brand a {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            text-decoration: none;
            color: var(--text-primary);
        }

        .header-brand a:hover {
            text-decoration: none;
        }

        .logo-icon {
            width: 28px;
            height: 28px;
        }

        header h1 {
            font-size: 1.25rem;
            font-weight: 600;
            background: linear-gradient(135deg, var(--accent) 0%, #ff9a9e 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .renderer-badge {
            font-size: 0.65rem;
            padding: 0.2rem 0.5rem;
            background: var(--bg-tertiary);
            border-radius: 12px;
            color: var(--text-muted);
            border: 1px solid var(--border);
            text-transform: uppercase;
            font-weight: 600;
            letter-spacing: 0.5px;
        }

        .renderer-badge.webgl2 {
            color: var(--success);
            border-color: var(--success);
            background: rgba(63, 185, 80, 0.1);
        }

        .controls {
            display: flex;
            gap: 0.5rem;
            align-items: center;
            flex-wrap: wrap;
        }

        .header-links {
            display: flex;
            gap: 1rem;
            align-items: center;
        }

        .github-link {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            color: var(--text-secondary);
            font-size: 0.875rem;
            padding: 0.4rem 0.75rem;
            border-radius: 6px;
            border: 1px solid var(--border);
            transition: all 0.2s;
        }

        .github-link:hover {
            color: var(--text-primary);
            border-color: var(--border-light);
            background: var(--bg-tertiary);
            text-decoration: none;
        }

        .github-link svg {
            fill: currentColor;
        }

        /* Buttons */
        .btn {
            background: var(--accent);
            color: white;
            border: none;
            padding: 0.6rem 1rem;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.875rem;
            font-weight: 500;
            transition: all 0.2s;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 0.4rem;
            white-space: nowrap;
        }

        .btn:hover {
            background: var(--accent-hover);
            text-decoration: none;
        }

        .btn:disabled {
            background: var(--bg-tertiary);
            color: var(--text-muted);
            cursor: not-allowed;
        }

        .btn-secondary {
            background: var(--bg-tertiary);
            border: 1px solid var(--border);
            color: var(--text-primary);
        }

        .btn-secondary:hover {
            background: var(--border);
            border-color: var(--border-light);
        }

        .btn-secondary.active {
            background: var(--accent-secondary);
            border-color: var(--accent-secondary);
            color: white;
        }

        .btn-secondary.active:hover {
            background: #2ea043;
            border-color: #2ea043;
        }

        .btn-success {
            background: var(--accent-secondary);
        }

        .btn-success:hover {
            background: #2ea043;
        }

        .btn-outline {
            background: transparent;
            border: 1px solid var(--accent);
            color: var(--accent);
        }

        .btn-outline:hover {
            background: var(--accent);
            color: white;
        }

        .btn-sm {
            padding: 0.4rem 0.75rem;
            font-size: 0.8rem;
        }

        .btn-lg {
            padding: 0.75rem 1.5rem;
            font-size: 1rem;
        }

        /* Main Layout */
        .app-container {
            display: grid;
            grid-template-columns: 1fr 380px;
            gap: 1rem;
            padding: 1rem;
            max-width: 1800px;
            margin: 0 auto;
            min-height: calc(100vh - 120px);
        }

        @media (max-width: 1200px) {
            .app-container {
                grid-template-columns: 1fr;
            }
        }

        /* Visualization Panel */
        .viz-panel {
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
        }

        #canvas-container {
            flex: 1;
            min-height: 500px;
            background: var(--bg-canvas);
            border-radius: 8px;
            overflow: hidden;
            position: relative;
            border: 1px solid var(--border);
        }

        #canvas {
            width: 100%;
            height: 100%;
            display: block;
            touch-action: none;
            -webkit-touch-callout: none;
            -webkit-user-select: none;
            user-select: none;
        }

        /* Empty state */
        .empty-state {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            text-align: center;
            color: var(--text-secondary);
            pointer-events: none;
            max-width: 400px;
            padding: 2rem;
        }

        .empty-state.hidden {
            display: none;
        }

        .empty-state-icon {
            width: 80px;
            height: 80px;
            margin: 0 auto 1rem;
            opacity: 0.4;
        }

        .empty-state h3 {
            font-size: 1.25rem;
            margin-bottom: 0.5rem;
            color: var(--text-primary);
        }

        .empty-state p {
            font-size: 0.9rem;
            line-height: 1.6;
        }

        /* Legend panel */
        .legend-panel {
            position: absolute;
            top: 10px;
            right: 10px;
            background: rgba(22, 27, 34, 0.95);
            border-radius: 8px;
            padding: 0.75rem;
            max-width: 180px;
            max-height: 280px;
            overflow-y: auto;
            z-index: 50;
            backdrop-filter: blur(8px);
            border: 1px solid var(--border);
            font-size: 0.75rem;
        }

        .legend-panel.collapsed {
            max-height: 32px;
            overflow: hidden;
        }

        .legend-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: pointer;
            margin-bottom: 0.5rem;
        }

        .legend-header h4 {
            font-size: 0.7rem;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin: 0;
        }

        .legend-toggle {
            font-size: 0.7rem;
            color: var(--text-muted);
            transition: transform 0.2s;
        }

        .legend-panel.collapsed .legend-toggle {
            transform: rotate(180deg);
        }

        .legend-items {
            display: flex;
            flex-direction: column;
            gap: 0.25rem;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .legend-color {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            flex-shrink: 0;
        }

        .legend-ext {
            color: var(--text-secondary);
            flex: 1;
        }

        .legend-count {
            color: var(--text-muted);
            font-size: 0.65rem;
        }

        /* Stats overlay */
        .stats-overlay {
            position: absolute;
            bottom: 10px;
            left: 10px;
            background: rgba(22, 27, 34, 0.9);
            border-radius: 6px;
            padding: 0.5rem 0.75rem;
            backdrop-filter: blur(8px);
            border: 1px solid var(--border);
            display: flex;
            gap: 1rem;
            font-size: 0.75rem;
        }

        .stat-item {
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .stat-value {
            font-weight: 600;
            font-size: 0.9rem;
            color: var(--text-primary);
            font-variant-numeric: tabular-nums;
        }

        .stat-label {
            color: var(--text-muted);
            font-size: 0.65rem;
            text-transform: uppercase;
        }

        /* Performance overlay (FPS, metrics) */
        .perf-overlay {
            position: absolute;
            top: 10px;
            left: 10px;
            background: rgba(13, 17, 23, 0.92);
            border-radius: 6px;
            padding: 0.5rem 0.75rem;
            backdrop-filter: blur(8px);
            border: 1px solid var(--border);
            font-family: 'SF Mono', 'Monaco', 'Inconsolata', 'Roboto Mono', monospace;
            font-size: 0.7rem;
            min-width: 140px;
            z-index: 60;
        }

        .perf-overlay.collapsed {
            min-width: auto;
        }

        .perf-overlay.collapsed .perf-details {
            display: none;
        }

        .perf-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: pointer;
            margin-bottom: 0.4rem;
        }

        .perf-overlay.collapsed .perf-header {
            margin-bottom: 0;
        }

        .perf-fps {
            font-weight: 700;
            font-size: 0.85rem;
        }

        .perf-fps.good { color: var(--success); }
        .perf-fps.ok { color: var(--warning); }
        .perf-fps.bad { color: var(--error); }

        .perf-toggle {
            color: var(--text-muted);
            font-size: 0.65rem;
            transition: transform 0.2s;
        }

        .perf-overlay.collapsed .perf-toggle {
            transform: rotate(180deg);
        }

        .perf-details {
            display: flex;
            flex-direction: column;
            gap: 0.2rem;
            border-top: 1px solid var(--border);
            padding-top: 0.4rem;
        }

        .perf-row {
            display: flex;
            justify-content: space-between;
            gap: 1rem;
        }

        .perf-label {
            color: var(--text-muted);
        }

        .perf-value {
            color: var(--text-primary);
            font-variant-numeric: tabular-nums;
            text-align: right;
        }

        /* Technical info panel */
        .tech-info-panel {
            background: linear-gradient(135deg, rgba(88, 166, 255, 0.08) 0%, rgba(233, 69, 96, 0.08) 100%);
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 1rem;
            margin-bottom: 0.75rem;
        }

        .tech-info-header {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-bottom: 0.75rem;
            font-weight: 600;
            font-size: 0.8rem;
            color: var(--text-primary);
        }

        .tech-info-header svg {
            color: var(--accent-blue);
        }

        .tech-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 0.5rem;
        }

        .tech-item {
            background: rgba(0, 0, 0, 0.2);
            border-radius: 4px;
            padding: 0.5rem;
            text-align: center;
        }

        .tech-item-value {
            font-weight: 700;
            font-size: 0.9rem;
            color: var(--accent-blue);
            font-variant-numeric: tabular-nums;
        }

        .tech-item-label {
            font-size: 0.65rem;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .tech-badges {
            display: flex;
            flex-wrap: wrap;
            gap: 0.4rem;
            margin-top: 0.75rem;
        }

        .tech-badge {
            font-size: 0.65rem;
            padding: 0.2rem 0.5rem;
            background: var(--bg-tertiary);
            border-radius: 10px;
            color: var(--text-secondary);
            border: 1px solid var(--border);
        }

        .tech-badge.highlight {
            background: rgba(233, 69, 96, 0.15);
            border-color: var(--accent);
            color: var(--accent);
        }

        /* Timeline */
        .timeline-container {
            background: var(--bg-secondary);
            border-radius: 8px;
            padding: 0.75rem 1rem;
            display: flex;
            align-items: center;
            gap: 0.75rem;
            border: 1px solid var(--border);
        }

        .timeline-controls {
            display: flex;
            gap: 0.25rem;
        }

        .timeline-btn {
            background: var(--bg-tertiary);
            border: 1px solid var(--border);
            color: var(--text-secondary);
            width: 32px;
            height: 32px;
            border-radius: 6px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
        }

        .timeline-btn:hover {
            background: var(--border);
            color: var(--text-primary);
        }

        .timeline-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .timeline-btn.active {
            background: var(--accent);
            border-color: var(--accent);
            color: white;
        }

        .timeline-slider {
            flex: 1;
            -webkit-appearance: none;
            appearance: none;
            height: 6px;
            background: var(--bg-tertiary);
            border-radius: 3px;
            outline: none;
        }

        .timeline-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 16px;
            height: 16px;
            background: var(--accent);
            border-radius: 50%;
            cursor: pointer;
            transition: transform 0.2s;
        }

        .timeline-slider::-webkit-slider-thumb:hover {
            transform: scale(1.2);
        }

        .timeline-slider::-moz-range-thumb {
            width: 16px;
            height: 16px;
            background: var(--accent);
            border-radius: 50%;
            cursor: pointer;
            border: none;
        }

        .timeline-slider:disabled {
            opacity: 0.5;
        }

        .timeline-info {
            font-size: 0.8rem;
            color: var(--text-secondary);
            min-width: 80px;
            text-align: right;
            font-variant-numeric: tabular-nums;
        }

        .speed-control {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding-left: 0.75rem;
            border-left: 1px solid var(--border);
        }

        .speed-control label {
            font-size: 0.75rem;
            color: var(--text-muted);
        }

        .speed-control select {
            background: var(--bg-tertiary);
            border: 1px solid var(--border);
            color: var(--text-primary);
            padding: 0.25rem 0.5rem;
            border-radius: 4px;
            font-size: 0.75rem;
        }

        /* Sidebar Panel */
        .sidebar-panel {
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
        }

        .panel {
            background: var(--bg-secondary);
            border-radius: 8px;
            border: 1px solid var(--border);
            overflow: hidden;
        }

        .panel-header {
            padding: 0.75rem 1rem;
            border-bottom: 1px solid var(--border);
            display: flex;
            align-items: center;
            justify-content: space-between;
            background: var(--bg-tertiary);
        }

        .panel-header h3 {
            font-size: 0.85rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .panel-header .badge {
            font-size: 0.65rem;
            padding: 0.15rem 0.4rem;
            background: var(--accent);
            color: white;
            border-radius: 10px;
            font-weight: 500;
        }

        .panel-body {
            padding: 1rem;
        }

        /* GitHub URL Input */
        .github-input-group {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 0.75rem;
        }

        .github-input-group input {
            flex: 1;
            background: var(--bg-tertiary);
            border: 1px solid var(--border);
            color: var(--text-primary);
            padding: 0.6rem 0.75rem;
            border-radius: 6px;
            font-size: 0.875rem;
        }

        .github-input-group input:focus {
            outline: none;
            border-color: var(--accent-blue);
            box-shadow: 0 0 0 3px rgba(88, 166, 255, 0.2);
        }

        .github-input-group input::placeholder {
            color: var(--text-muted);
        }

        .popular-repos {
            margin-top: 0.75rem;
        }

        .popular-repos-label {
            font-size: 0.7rem;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 0.5rem;
            display: block;
        }

        .repo-chips {
            display: flex;
            flex-wrap: wrap;
            gap: 0.4rem;
        }

        .repo-chip {
            background: var(--bg-tertiary);
            border: 1px solid var(--border);
            color: var(--text-secondary);
            padding: 0.3rem 0.6rem;
            border-radius: 16px;
            font-size: 0.75rem;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 0.3rem;
        }

        .repo-chip:hover {
            border-color: var(--accent);
            color: var(--accent);
            background: rgba(233, 69, 96, 0.1);
        }

        .repo-chip svg {
            width: 12px;
            height: 12px;
        }

        /* Loading state for fetch */
        .fetch-status {
            margin-top: 0.75rem;
            padding: 0.75rem;
            background: var(--bg-tertiary);
            border-radius: 6px;
            font-size: 0.8rem;
            display: none;
        }

        .fetch-status.visible {
            display: block;
        }

        .fetch-status.loading {
            color: var(--accent-blue);
        }

        .fetch-status.error {
            color: var(--error);
            background: rgba(248, 81, 73, 0.1);
            border: 1px solid rgba(248, 81, 73, 0.3);
        }

        .fetch-status.success {
            color: var(--success);
            background: rgba(63, 185, 80, 0.1);
            border: 1px solid rgba(63, 185, 80, 0.3);
        }

        .fetch-progress {
            margin-top: 0.5rem;
            height: 4px;
            background: var(--bg-primary);
            border-radius: 2px;
            overflow: hidden;
        }

        .fetch-progress-bar {
            height: 100%;
            background: var(--accent-blue);
            width: 0%;
            transition: width 0.3s;
        }

        /* Tab navigation */
        .tab-nav {
            display: flex;
            border-bottom: 1px solid var(--border);
            background: var(--bg-tertiary);
        }

        .tab-btn {
            flex: 1;
            padding: 0.6rem 0.75rem;
            background: transparent;
            border: none;
            color: var(--text-secondary);
            cursor: pointer;
            font-size: 0.8rem;
            font-weight: 500;
            transition: all 0.2s;
            border-bottom: 2px solid transparent;
            margin-bottom: -1px;
        }

        .tab-btn:hover {
            color: var(--text-primary);
            background: rgba(255, 255, 255, 0.03);
        }

        .tab-btn.active {
            color: var(--accent);
            border-bottom-color: var(--accent);
        }

        .tab-content {
            display: none;
            padding: 1rem;
        }

        .tab-content.active {
            display: block;
        }

        /* Textarea */
        textarea {
            width: 100%;
            height: 100px;
            background: var(--bg-tertiary);
            border: 1px solid var(--border);
            color: var(--text-primary);
            padding: 0.75rem;
            border-radius: 6px;
            font-family: 'SF Mono', 'Monaco', 'Inconsolata', 'Roboto Mono', monospace;
            font-size: 0.75rem;
            resize: vertical;
            margin-bottom: 0.75rem;
        }

        textarea:focus {
            outline: none;
            border-color: var(--accent-blue);
        }

        /* File upload */
        .file-upload-area {
            border: 2px dashed var(--border);
            border-radius: 8px;
            padding: 1.5rem;
            text-align: center;
            margin-bottom: 0.75rem;
            cursor: pointer;
            transition: all 0.2s;
        }

        .file-upload-area:hover {
            border-color: var(--accent);
            background: rgba(233, 69, 96, 0.05);
        }

        .file-upload-area.dragover {
            border-color: var(--accent);
            background: rgba(233, 69, 96, 0.1);
        }

        .file-upload-area input[type="file"] {
            display: none;
        }

        .file-upload-icon {
            font-size: 2rem;
            margin-bottom: 0.5rem;
        }

        .file-upload-text {
            font-size: 0.85rem;
            color: var(--text-secondary);
        }

        .file-upload-text strong {
            color: var(--accent);
        }

        .file-name {
            margin-bottom: 0.75rem;
            color: var(--text-secondary);
            font-size: 0.8rem;
            padding: 0.5rem;
            background: var(--bg-tertiary);
            border-radius: 4px;
        }

        /* Command box */
        .command-box {
            background: var(--bg-tertiary);
            padding: 0.75rem;
            border-radius: 6px;
            font-family: 'SF Mono', 'Monaco', 'Inconsolata', 'Roboto Mono', monospace;
            font-size: 0.7rem;
            overflow-x: auto;
            margin-bottom: 0.75rem;
            border: 1px solid var(--border);
        }

        .command-box code {
            color: var(--text-primary);
            white-space: pre-wrap;
            word-break: break-all;
        }

        /* Help text */
        .help-text {
            font-size: 0.75rem;
            color: var(--text-muted);
            line-height: 1.6;
        }

        .help-text code {
            background: var(--bg-tertiary);
            padding: 0.1rem 0.3rem;
            border-radius: 3px;
            font-size: 0.7rem;
        }

        /* Documentation Panel */
        .docs-panel {
            max-height: 400px;
            overflow-y: auto;
        }

        .docs-section {
            margin-bottom: 1.25rem;
        }

        .docs-section:last-child {
            margin-bottom: 0;
        }

        .docs-section h4 {
            font-size: 0.8rem;
            color: var(--accent);
            margin-bottom: 0.5rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .docs-section p {
            font-size: 0.8rem;
            color: var(--text-secondary);
            line-height: 1.6;
            margin-bottom: 0.5rem;
        }

        .shortcut-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 0.4rem;
        }

        .shortcut-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.4rem 0.5rem;
            background: var(--bg-tertiary);
            border-radius: 4px;
            font-size: 0.75rem;
        }

        .shortcut-item kbd {
            background: var(--bg-primary);
            padding: 0.15rem 0.4rem;
            border-radius: 3px;
            font-family: inherit;
            font-size: 0.7rem;
            border: 1px solid var(--border);
        }

        .feature-list {
            list-style: none;
        }

        .feature-list li {
            padding: 0.3rem 0;
            font-size: 0.8rem;
            color: var(--text-secondary);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .feature-list li::before {
            content: '';
            width: 6px;
            height: 6px;
            background: var(--accent);
            border-radius: 50%;
            flex-shrink: 0;
        }

        /* Showcase panel (prominent Rource visualization) */
        .showcase-panel {
            background: linear-gradient(135deg, rgba(233, 69, 96, 0.15) 0%, rgba(88, 166, 255, 0.15) 100%);
            border: 2px solid var(--accent);
            border-radius: 10px;
            padding: 1.25rem;
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        .showcase-panel::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, var(--accent), var(--accent-blue), var(--accent));
        }

        .showcase-badge {
            position: absolute;
            top: 10px;
            right: 10px;
            font-size: 0.6rem;
            padding: 0.2rem 0.5rem;
            background: var(--accent);
            color: white;
            border-radius: 10px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .showcase-icon {
            width: 48px;
            height: 48px;
            margin: 0 auto 0.75rem;
        }

        .showcase-panel h3 {
            font-size: 1.1rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
            color: var(--text-primary);
        }

        .showcase-panel p {
            font-size: 0.85rem;
            color: var(--text-secondary);
            margin-bottom: 1rem;
            line-height: 1.5;
        }

        .showcase-btn {
            background: var(--accent);
            color: white;
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: 8px;
            font-size: 0.95rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            box-shadow: 0 2px 8px rgba(233, 69, 96, 0.3);
        }

        .showcase-btn:hover {
            background: var(--accent-hover);
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(233, 69, 96, 0.4);
        }

        .showcase-btn:disabled {
            background: var(--bg-tertiary);
            color: var(--text-muted);
            cursor: not-allowed;
            box-shadow: none;
            transform: none;
        }

        .showcase-stats {
            display: flex;
            justify-content: center;
            gap: 1.5rem;
            margin-top: 1rem;
            padding-top: 1rem;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }

        .showcase-stat {
            text-align: center;
        }

        .showcase-stat-value {
            font-size: 1.1rem;
            font-weight: 700;
            color: var(--accent-blue);
        }

        .showcase-stat-label {
            font-size: 0.65rem;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        /* Authors legend panel */
        .authors-panel {
            position: absolute;
            bottom: 10px;
            right: 10px;
            background: rgba(22, 27, 34, 0.95);
            border-radius: 8px;
            padding: 0.75rem;
            max-width: 200px;
            max-height: 200px;
            overflow-y: auto;
            z-index: 50;
            backdrop-filter: blur(8px);
            border: 1px solid var(--border);
            font-size: 0.75rem;
        }

        .authors-panel.collapsed {
            max-height: 32px;
            overflow: hidden;
        }

        .authors-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: pointer;
            margin-bottom: 0.5rem;
        }

        .authors-header h4 {
            font-size: 0.7rem;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin: 0;
        }

        .authors-toggle {
            font-size: 0.7rem;
            color: var(--text-muted);
            transition: transform 0.2s;
        }

        .authors-panel.collapsed .authors-toggle {
            transform: rotate(180deg);
        }

        .authors-items {
            display: flex;
            flex-direction: column;
            gap: 0.35rem;
        }

        .author-item {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .author-color {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            flex-shrink: 0;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .author-name {
            color: var(--text-secondary);
            flex: 1;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        .author-commits {
            color: var(--text-muted);
            font-size: 0.65rem;
            flex-shrink: 0;
        }

        /* About section */
        .about-banner {
            background: linear-gradient(135deg, rgba(233, 69, 96, 0.1) 0%, rgba(88, 166, 255, 0.1) 100%);
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 1rem;
            text-align: center;
        }

        .about-banner h4 {
            font-size: 0.9rem;
            margin-bottom: 0.5rem;
        }

        .about-banner p {
            font-size: 0.8rem;
            color: var(--text-secondary);
            margin-bottom: 0.75rem;
        }

        .about-links {
            display: flex;
            justify-content: center;
            gap: 0.75rem;
        }

        /* Loading overlay */
        #loading {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: var(--bg-primary);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }

        #loading.hidden {
            display: none;
        }

        .loading-spinner {
            width: 48px;
            height: 48px;
            border: 3px solid var(--bg-tertiary);
            border-top-color: var(--accent);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-bottom: 1rem;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .spin {
            animation: spin 1s linear infinite;
        }

        .loading-text {
            font-size: 1rem;
            color: var(--text-secondary);
        }

        /* Toast */
        .toast {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%) translateY(100px);
            background: var(--bg-secondary);
            border-radius: 8px;
            padding: 0.75rem 1rem;
            box-shadow: 0 4px 20px var(--shadow);
            z-index: 1000;
            transition: transform 0.3s ease;
            max-width: 90%;
            display: flex;
            align-items: center;
            gap: 0.75rem;
            border: 1px solid var(--border);
        }

        .toast.visible {
            transform: translateX(-50%) translateY(0);
        }

        .toast.error {
            border-left: 3px solid var(--error);
        }

        .toast.success {
            border-left: 3px solid var(--success);
        }

        .toast-message {
            flex: 1;
            font-size: 0.875rem;
        }

        .toast-close {
            background: none;
            border: none;
            color: var(--text-muted);
            cursor: pointer;
            padding: 0.25rem;
            font-size: 1.25rem;
            line-height: 1;
        }

        /* Footer */
        footer {
            background: var(--bg-secondary);
            padding: 1rem 2rem;
            text-align: center;
            border-top: 1px solid var(--border);
            font-size: 0.8rem;
            color: var(--text-muted);
        }

        footer a {
            color: var(--accent);
        }

        .footer-links {
            display: flex;
            justify-content: center;
            gap: 1.5rem;
            flex-wrap: wrap;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .app-container {
                padding: 0.75rem;
            }

            #canvas-container {
                min-height: 350px;
            }

            .timeline-container {
                flex-wrap: wrap;
            }

            .speed-control {
                width: 100%;
                border-left: none;
                padding-left: 0;
                padding-top: 0.5rem;
                border-top: 1px solid var(--border);
                margin-top: 0.5rem;
            }

            .stats-overlay {
                font-size: 0.65rem;
                gap: 0.75rem;
            }

            .shortcut-grid {
                grid-template-columns: 1fr;
            }
        }

        /* Utility */
        .hidden {
            display: none !important;
        }

        .visually-hidden {
            position: absolute;
            width: 1px;
            height: 1px;
            padding: 0;
            margin: -1px;
            overflow: hidden;
            clip: rect(0, 0, 0, 0);
            white-space: nowrap;
            border: 0;
        }
    </style>
</head>
<body>
    <a href="#main-content" class="skip-link">Skip to main content</a>

    <div id="loading" role="status" aria-live="polite">
        <div class="loading-spinner" aria-hidden="true"></div>
        <div class="loading-text">Loading Rource...</div>
    </div>

    <header>
        <div class="header-brand">
            <a href="https://github.com/tomtom215/rource" target="_blank" rel="noopener noreferrer" title="View Rource on GitHub">
                <svg class="logo-icon" viewBox="0 0 100 100" aria-hidden="true">
                    <circle cx="50" cy="50" r="45" fill="#e94560"/>
                    <circle cx="50" cy="30" r="8" fill="white"/>
                    <circle cx="30" cy="60" r="6" fill="white"/>
                    <circle cx="70" cy="55" r="6" fill="white"/>
                    <circle cx="50" cy="75" r="5" fill="white"/>
                    <line x1="50" y1="38" x2="50" y2="70" stroke="white" stroke-width="2"/>
                    <line x1="50" y1="50" x2="32" y2="58" stroke="white" stroke-width="2"/>
                    <line x1="50" y1="50" x2="68" y2="53" stroke="white" stroke-width="2"/>
                </svg>
                <h1>Rource</h1>
            </a>
            <span id="renderer-badge" class="renderer-badge" title="Rendering backend"></span>
        </div>
        <div class="controls">
            <button id="btn-play" class="btn btn-sm" disabled aria-label="Play visualization">
                <svg id="play-icon" width="14" height="14" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true">
                    <path d="M8 5v14l11-7z"/>
                </svg>
                <span id="play-text">Play</span>
            </button>
            <button id="btn-reset" class="btn btn-sm btn-secondary" disabled aria-label="Reset camera">
                <svg width="14" height="14" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true">
                    <path d="M12 5V1L7 6l5 5V7c3.31 0 6 2.69 6 6s-2.69 6-6 6-6-2.69-6-6H4c0 4.42 3.58 8 8 8s8-3.58 8-8-3.58-8-8-8z"/>
                </svg>
                Reset
            </button>
            <button id="btn-labels" class="btn btn-sm btn-secondary" disabled aria-label="Toggle labels" title="Toggle labels (L)">
                <svg width="14" height="14" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true">
                    <path d="M3 18h12v-2H3v2zM3 6v2h18V6H3zm0 7h18v-2H3v2z"/>
                </svg>
                <span id="labels-text">Labels</span>
            </button>
        </div>
        <div class="header-links">
            <a href="https://github.com/tomtom215/rource" target="_blank" rel="noopener noreferrer" class="github-link">
                <svg width="16" height="16" viewBox="0 0 16 16" aria-hidden="true">
                    <path d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0016 8c0-4.42-3.58-8-8-8z"/>
                </svg>
                Star on GitHub
            </a>
        </div>
    </header>

    <main id="main-content" class="app-container">
        <!-- Visualization Panel -->
        <div class="viz-panel">
            <div id="canvas-container">
                <canvas id="canvas" width="1280" height="720" aria-label="Rource visualization canvas"></canvas>
                <div id="empty-state" class="empty-state">
                    <svg class="empty-state-icon" viewBox="0 0 100 100" aria-hidden="true">
                        <circle cx="50" cy="50" r="45" fill="none" stroke="currentColor" stroke-width="2" opacity="0.3"/>
                        <circle cx="50" cy="30" r="6" fill="currentColor" opacity="0.5"/>
                        <circle cx="30" cy="60" r="5" fill="currentColor" opacity="0.5"/>
                        <circle cx="70" cy="55" r="5" fill="currentColor" opacity="0.5"/>
                        <line x1="50" y1="36" x2="50" y2="50" stroke="currentColor" stroke-width="1.5" opacity="0.3"/>
                        <line x1="50" y1="50" x2="34" y2="58" stroke="currentColor" stroke-width="1.5" opacity="0.3"/>
                        <line x1="50" y1="50" x2="66" y2="53" stroke="currentColor" stroke-width="1.5" opacity="0.3"/>
                    </svg>
                    <h3>Ready to Visualize</h3>
                    <p>Enter a GitHub repository URL or load your own git log data to watch your codebase come to life.</p>
                </div>
                <div id="legend-panel" class="legend-panel collapsed" role="complementary" aria-label="File type legend">
                    <div class="legend-header" id="legend-toggle" role="button" tabindex="0" aria-expanded="false">
                        <h4>File Types</h4>
                        <span class="legend-toggle" aria-hidden="true">&#9660;</span>
                    </div>
                    <div class="legend-items" id="legend-items" role="list"></div>
                </div>
                <div id="stats-overlay" class="stats-overlay hidden">
                    <div class="stat-item">
                        <span class="stat-value" id="stat-commits">0</span>
                        <span class="stat-label">Commits</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-value" id="stat-files">0</span>
                        <span class="stat-label">Files</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-value" id="stat-authors">0</span>
                        <span class="stat-label">Authors</span>
                    </div>
                </div>
                <!-- Authors legend panel -->
                <div id="authors-panel" class="authors-panel hidden collapsed" role="complementary" aria-label="Authors legend">
                    <div class="authors-header" id="authors-toggle" role="button" tabindex="0" aria-expanded="false">
                        <h4>Authors</h4>
                        <span class="authors-toggle" aria-hidden="true">&#9660;</span>
                    </div>
                    <div class="authors-items" id="authors-items" role="list"></div>
                </div>
                <!-- Performance metrics overlay -->
                <div id="perf-overlay" class="perf-overlay hidden" role="complementary" aria-label="Performance metrics">
                    <div class="perf-header" id="perf-toggle" role="button" tabindex="0" aria-expanded="true">
                        <span class="perf-fps good" id="perf-fps">-- FPS</span>
                        <span class="perf-toggle" aria-hidden="true">&#9650;</span>
                    </div>
                    <div class="perf-details">
                        <div class="perf-row">
                            <span class="perf-label">Frame</span>
                            <span class="perf-value" id="perf-frame-time">--ms</span>
                        </div>
                        <div class="perf-row">
                            <span class="perf-label">Entities</span>
                            <span class="perf-value" id="perf-entities">--</span>
                        </div>
                        <div class="perf-row">
                            <span class="perf-label">Visible</span>
                            <span class="perf-value" id="perf-visible">--</span>
                        </div>
                        <div class="perf-row">
                            <span class="perf-label">Draw Calls</span>
                            <span class="perf-value" id="perf-draws">--</span>
                        </div>
                        <div class="perf-row">
                            <span class="perf-label">Resolution</span>
                            <span class="perf-value" id="perf-resolution">--</span>
                        </div>
                    </div>
                </div>
            </div>

            <div class="timeline-container" role="group" aria-label="Timeline controls">
                <div class="timeline-controls">
                    <button id="btn-prev" class="timeline-btn" disabled title="Previous commit (< or ,)">
                        <svg width="12" height="12" viewBox="0 0 24 24" fill="currentColor"><path d="M15.41 7.41L14 6l-6 6 6 6 1.41-1.41L10.83 12z"/></svg>
                    </button>
                    <button id="btn-play-small" class="timeline-btn" disabled title="Play/Pause (Space)">
                        <svg id="play-icon-small" width="12" height="12" viewBox="0 0 24 24" fill="currentColor"><path d="M8 5v14l11-7z"/></svg>
                    </button>
                    <button id="btn-next" class="timeline-btn" disabled title="Next commit (> or .)">
                        <svg width="12" height="12" viewBox="0 0 24 24" fill="currentColor"><path d="M10 6L8.59 7.41 13.17 12l-4.58 4.59L10 18l6-6z"/></svg>
                    </button>
                </div>
                <input type="range" id="timeline-slider" class="timeline-slider" min="0" max="0" value="0" disabled>
                <span class="timeline-info" id="timeline-info">0 / 0</span>
                <div class="speed-control">
                    <label for="speed-select">Speed:</label>
                    <select id="speed-select" disabled>
                        <option value="1">0.1x (Slow)</option>
                        <option value="5">0.5x</option>
                        <option value="10" selected>1x (Normal)</option>
                        <option value="20">2x</option>
                        <option value="50">5x (Fast)</option>
                        <option value="100">10x (Very Fast)</option>
                    </select>
                </div>
            </div>
        </div>

        <!-- Sidebar Panel -->
        <div class="sidebar-panel">
            <!-- Showcase Panel: Visualize This Project -->
            <div class="showcase-panel" id="showcase-panel">
                <span class="showcase-badge">Featured</span>
                <svg class="showcase-icon" viewBox="0 0 100 100" aria-hidden="true">
                    <circle cx="50" cy="50" r="45" fill="#e94560"/>
                    <circle cx="50" cy="30" r="8" fill="white"/>
                    <circle cx="30" cy="60" r="6" fill="white"/>
                    <circle cx="70" cy="55" r="6" fill="white"/>
                    <circle cx="50" cy="75" r="5" fill="white"/>
                    <line x1="50" y1="38" x2="50" y2="70" stroke="white" stroke-width="2"/>
                    <line x1="50" y1="50" x2="32" y2="58" stroke="white" stroke-width="2"/>
                    <line x1="50" y1="50" x2="68" y2="53" stroke="white" stroke-width="2"/>
                </svg>
                <h3>Visualize This Project</h3>
                <p>Watch the complete development history of Rource itself. Cached locally - no API limits.</p>
                <button id="btn-visualize-rource" class="showcase-btn" disabled>
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M8 5v14l11-7z"/>
                    </svg>
                    Visualize Rource
                </button>
                <div class="showcase-stats">
                    <div class="showcase-stat">
                        <div class="showcase-stat-value" id="showcase-commits">--</div>
                        <div class="showcase-stat-label">Commits</div>
                    </div>
                    <div class="showcase-stat">
                        <div class="showcase-stat-value" id="showcase-files">--</div>
                        <div class="showcase-stat-label">Files</div>
                    </div>
                    <div class="showcase-stat">
                        <div class="showcase-stat-value" id="showcase-authors">--</div>
                        <div class="showcase-stat-label">Authors</div>
                    </div>
                </div>
            </div>

            <!-- GitHub URL Panel -->
            <div class="panel">
                <div class="panel-header">
                    <h3>
                        <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor" aria-hidden="true">
                            <path d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0016 8c0-4.42-3.58-8-8-8z"/>
                        </svg>
                        Other Repositories
                    </h3>
                </div>
                <div class="panel-body">
                    <div class="github-input-group">
                        <input type="text" id="github-url" placeholder="https://github.com/owner/repo" aria-label="GitHub repository URL">
                        <button id="btn-fetch-github" class="btn btn-success btn-sm" disabled>
                            <svg width="14" height="14" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true">
                                <path d="M19 9h-4V3H9v6H5l7 7 7-7zM5 18v2h14v-2H5z"/>
                            </svg>
                            Fetch
                        </button>
                    </div>
                    <div class="popular-repos">
                        <span class="popular-repos-label">Try a popular repository:</span>
                        <div class="repo-chips">
                            <button class="repo-chip" data-repo="facebook/react">
                                <svg viewBox="0 0 16 16" fill="currentColor"><circle cx="8" cy="8" r="3"/></svg>
                                react
                            </button>
                            <button class="repo-chip" data-repo="microsoft/vscode">
                                <svg viewBox="0 0 16 16" fill="currentColor"><circle cx="8" cy="8" r="3"/></svg>
                                vscode
                            </button>
                            <button class="repo-chip" data-repo="rust-lang/rust">
                                <svg viewBox="0 0 16 16" fill="currentColor"><circle cx="8" cy="8" r="3"/></svg>
                                rust
                            </button>
                            <button class="repo-chip" data-repo="torvalds/linux">
                                <svg viewBox="0 0 16 16" fill="currentColor"><circle cx="8" cy="8" r="3"/></svg>
                                linux
                            </button>
                        </div>
                    </div>
                    <div id="fetch-status" class="fetch-status">
                        <span id="fetch-status-text"></span>
                        <div class="fetch-progress">
                            <div id="fetch-progress-bar" class="fetch-progress-bar"></div>
                        </div>
                    </div>
                    <p class="help-text" style="margin-top: 0.75rem;">
                        Fetches up to 100 recent commits from any public GitHub repository using the GitHub API.
                    </p>
                </div>
            </div>

            <!-- Manual Load Panel -->
            <div class="panel">
                <div class="tab-nav" role="tablist">
                    <button class="tab-btn active" data-tab="paste" role="tab" aria-selected="true">Paste Log</button>
                    <button class="tab-btn" data-tab="upload" role="tab" aria-selected="false">Upload File</button>
                    <button class="tab-btn" data-tab="command" role="tab" aria-selected="false">Git Command</button>
                </div>

                <div id="tab-paste" class="tab-content active" role="tabpanel">
                    <textarea id="log-input" placeholder="Paste your log data here...&#10;Format: timestamp|author|action|path"></textarea>
                    <button id="btn-load" class="btn btn-sm" disabled>Load Log Data</button>
                    <p class="help-text">
                        Format: <code>timestamp|author|action|path</code><br>
                        Actions: <code>A</code>=Add, <code>M</code>=Modify, <code>D</code>=Delete
                    </p>
                </div>

                <div id="tab-upload" class="tab-content" role="tabpanel" hidden>
                    <div class="file-upload-area" id="file-drop-zone">
                        <input type="file" id="file-input" accept=".txt,.log,.csv">
                        <div class="file-upload-icon">&#128194;</div>
                        <div class="file-upload-text">
                            <strong>Click to upload</strong> or drag and drop
                        </div>
                    </div>
                    <div id="file-name" class="file-name hidden"></div>
                    <button id="btn-load-file" class="btn btn-sm" disabled>Load Uploaded File</button>
                    <div class="help-text" style="margin-top: 0.75rem;">
                        <strong>Accepted formats:</strong><br>
                        <code>.txt</code>, <code>.log</code>, or <code>.csv</code> files containing log data in the format:<br>
                        <code>timestamp|author|action|path</code><br>
                        <em>Example:</em> <code>1609459200|John Doe|A|src/main.rs</code><br>
                        <span style="color: var(--text-muted); font-size: 0.85em;">Use the "Git Command" tab to generate this file from your local repository.</span>
                    </div>
                </div>

                <div id="tab-command" class="tab-content" role="tabpanel" hidden>
                    <p class="help-text" style="margin-bottom: 0.75rem;">Generate a log file from your local repository:</p>
                    <div class="command-box">
                        <code id="git-command">git log --reverse --format="%at|%an" --name-status | awk '/^[0-9]+\|/{info=$0;next}/^[AMD]\t/{print info"|"substr($0,1,1)"|"substr($0,3)}' > rource.log</code>
                    </div>
                    <button id="btn-copy-command" class="btn btn-sm btn-secondary">
                        <svg width="12" height="12" viewBox="0 0 24 24" fill="currentColor"><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"/></svg>
                        Copy Command
                    </button>
                    <div class="help-text" style="margin-top: 0.75rem;">
                        <strong>How to use:</strong>
                        <ol style="margin: 0.5rem 0 0 1.2rem; padding: 0;">
                            <li>Open a terminal in your Git repository</li>
                            <li>Run the command above (creates <code>rource.log</code>)</li>
                            <li>Upload the generated file using the "Upload File" tab</li>
                        </ol>
                        <p style="margin-top: 0.5rem; color: var(--text-muted); font-size: 0.85em;">
                            <strong>Note:</strong> Works on Linux/macOS. For Windows, use Git Bash or WSL.
                        </p>
                    </div>
                </div>
            </div>

            <!-- Documentation Panel -->
            <div class="panel">
                <div class="panel-header">
                    <h3>
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true">
                            <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 17h-2v-6h2v6zm0-8h-2V7h2v4z"/>
                        </svg>
                        Quick Guide
                    </h3>
                </div>
                <div class="panel-body docs-panel">
                    <div class="docs-section">
                        <h4>What is Rource?</h4>
                        <p><a href="https://github.com/tomtom215/rource" target="_blank" rel="noopener">Rource</a> visualizes software version control history as an animated tree. Each file is a colored node, each developer has a unique color, and commits create "beams" connecting developers to files they modify.</p>
                    </div>
                    <div class="docs-section">
                        <h4>Keyboard Shortcuts</h4>
                        <div class="shortcut-grid">
                            <div class="shortcut-item"><span>Play/Pause</span><kbd>Space</kbd></div>
                            <div class="shortcut-item"><span>Zoom In</span><kbd>+</kbd></div>
                            <div class="shortcut-item"><span>Zoom Out</span><kbd>-</kbd></div>
                            <div class="shortcut-item"><span>Reset View</span><kbd>R</kbd></div>
                            <div class="shortcut-item"><span>Pan</span><kbd>Arrows</kbd></div>
                            <div class="shortcut-item"><span>Labels</span><kbd>L</kbd></div>
                            <div class="shortcut-item"><span>Step Fwd</span><kbd>&gt;</kbd></div>
                            <div class="shortcut-item"><span>Step Back</span><kbd>&lt;</kbd></div>
                            <div class="shortcut-item"><span>Speed Down</span><kbd>[</kbd></div>
                            <div class="shortcut-item"><span>Speed Up</span><kbd>]</kbd></div>
                            <div class="shortcut-item"><span>Perf Stats</span><kbd>P</kbd></div>
                            <div class="shortcut-item"><span>Authors</span><kbd>A</kbd></div>
                        </div>
                    </div>
                    <div class="docs-section">
                        <h4>Mouse/Touch Controls</h4>
                        <ul class="feature-list">
                            <li>Drag to pan the view</li>
                            <li>Scroll wheel or pinch to zoom</li>
                        </ul>
                    </div>
                    <div class="docs-section">
                        <h4>Features</h4>
                        <ul class="feature-list">
                            <li>WebGL2 GPU-accelerated rendering</li>
                            <li>Force-directed graph layout</li>
                            <li>Color-coded file types</li>
                            <li>Runs entirely in browser (~76KB)</li>
                            <li>No server or installation needed</li>
                        </ul>
                    </div>
                </div>
            </div>

            <!-- Technical Showcase Panel -->
            <div class="tech-info-panel" id="tech-info-panel">
                <div class="tech-info-header">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true">
                        <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-1 17.93c-3.95-.49-7-3.85-7-7.93 0-.62.08-1.21.21-1.79L9 15v1c0 1.1.9 2 2 2v1.93zm6.9-2.54c-.26-.81-1-1.39-1.9-1.39h-1v-3c0-.55-.45-1-1-1H8v-2h2c.55 0 1-.45 1-1V7h2c1.1 0 2-.9 2-2v-.41c2.93 1.19 5 4.06 5 7.41 0 2.08-.8 3.97-2.1 5.39z"/>
                    </svg>
                    Technical Specifications
                </div>
                <div class="tech-grid">
                    <div class="tech-item">
                        <div class="tech-item-value" id="tech-wasm-size">~76KB</div>
                        <div class="tech-item-label">WASM Gzipped</div>
                    </div>
                    <div class="tech-item">
                        <div class="tech-item-value" id="tech-renderer">WebGL2</div>
                        <div class="tech-item-label">Renderer</div>
                    </div>
                    <div class="tech-item">
                        <div class="tech-item-value" id="tech-tests">671</div>
                        <div class="tech-item-label">Unit Tests</div>
                    </div>
                    <div class="tech-item">
                        <div class="tech-item-value" id="tech-crates">4</div>
                        <div class="tech-item-label">Rust Crates</div>
                    </div>
                </div>
                <div class="tech-badges">
                    <span class="tech-badge highlight">Rust</span>
                    <span class="tech-badge highlight">WebAssembly</span>
                    <span class="tech-badge">Zero Dependencies</span>
                    <span class="tech-badge">GPU Accelerated</span>
                    <span class="tech-badge">Instanced Rendering</span>
                    <span class="tech-badge">60 FPS Target</span>
                </div>
            </div>

            <!-- About Panel -->
            <div class="about-banner">
                <h4>Built with Rust + WebAssembly</h4>
                <p><a href="https://github.com/tomtom215/rource" target="_blank" rel="noopener">Rource</a> is a modern rewrite of <a href="https://gource.io" target="_blank" rel="noopener">Gource</a>, the popular version control visualization tool.</p>
                <div class="about-links">
                    <a href="https://github.com/tomtom215/rource" target="_blank" rel="noopener" class="btn btn-sm btn-outline">
                        <svg width="14" height="14" viewBox="0 0 16 16" fill="currentColor"><path d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0016 8c0-4.42-3.58-8-8-8z"/></svg>
                        View Source
                    </a>
                    <a href="https://github.com/tomtom215/rource/issues" target="_blank" rel="noopener" class="btn btn-sm btn-secondary">
                        Report Issue
                    </a>
                </div>
            </div>
        </div>
    </main>

    <footer>
        <div class="footer-links">
            <span><strong><a href="https://github.com/tomtom215/rource">Rource</a></strong> - Software Version Control Visualization</span>
            <a href="https://github.com/tomtom215/rource" target="_blank" rel="noopener">GitHub</a>
            <a href="https://github.com/tomtom215/rource/issues" target="_blank" rel="noopener">Issues</a>
            <a href="https://gource.io" target="_blank" rel="noopener">Original Gource</a>
            <span>GPL-3.0 License</span>
        </div>
    </footer>

    <!-- Toast -->
    <div id="toast" class="toast" role="alert" aria-live="assertive">
        <span class="toast-message"></span>
        <button class="toast-close" aria-label="Close">&times;</button>
    </div>

    <script type="module">
        import init, { Rource } from './pkg/rource_wasm.js';

        // State
        let rource = null;
        let animationId = null;
        let uploadedFileContent = null;
        let hasLoadedData = false;
        let commitStats = { commits: 0, files: 0, authors: new Set() };

        // =====================================================================
        // CACHED ROURCE REPOSITORY DATA
        // =====================================================================
        // This is the complete commit history of the Rource project itself.
        // Cached locally to ensure the demo always works without API rate limits.
        // Generated from: git log --reverse --format="%at|%an" --name-status
        // Last updated: 2026-01-11
        // =====================================================================
        const ROURCE_CACHED_DATA = `1768004902|Tom F|A|LICENSE
1768004902|Tom F|A|README.md
1768006231|Claude|A|GOURCE_RUST_REWRITE_PLAN.md
1768028263|Claude|A|CLAUDE.md
1768028263|Claude|A|scripts/session-setup.sh
1768029507|Claude|A|.gitignore
1768029507|Claude|A|Cargo.toml
1768029507|Claude|A|crates/rource-core/Cargo.toml
1768029507|Claude|A|crates/rource-core/src/entity.rs
1768029507|Claude|A|crates/rource-core/src/lib.rs
1768029507|Claude|A|crates/rource-math/Cargo.toml
1768029507|Claude|A|crates/rource-math/src/color.rs
1768029507|Claude|A|crates/rource-math/src/lib.rs
1768029507|Claude|A|crates/rource-math/src/mat3.rs
1768029507|Claude|A|crates/rource-math/src/mat4.rs
1768029507|Claude|A|crates/rource-math/src/rect.rs
1768029507|Claude|A|crates/rource-math/src/vec2.rs
1768029507|Claude|A|crates/rource-math/src/vec3.rs
1768029507|Claude|A|crates/rource-math/src/vec4.rs
1768029507|Claude|A|crates/rource-vcs/Cargo.toml
1768029507|Claude|A|crates/rource-vcs/src/commit.rs
1768029507|Claude|A|crates/rource-vcs/src/lib.rs
1768029545|Claude|M|CLAUDE.md
1768039323|Claude|A|crates/rource-vcs/src/detect.rs
1768039323|Claude|A|crates/rource-vcs/src/error.rs
1768039323|Claude|M|crates/rource-vcs/src/lib.rs
1768039323|Claude|A|crates/rource-vcs/src/parser/custom.rs
1768039323|Claude|A|crates/rource-vcs/src/parser/git.rs
1768039323|Claude|A|crates/rource-vcs/src/parser/mod.rs
1768039351|Claude|M|CLAUDE.md
1768041150|Claude|M|CLAUDE.md
1768041150|Claude|M|crates/rource-core/src/lib.rs
1768041150|Claude|A|crates/rource-core/src/physics/mod.rs
1768041150|Claude|A|crates/rource-core/src/physics/spatial.rs
1768041150|Claude|A|crates/rource-core/src/scene/action.rs
1768041150|Claude|A|crates/rource-core/src/scene/file.rs
1768041150|Claude|A|crates/rource-core/src/scene/mod.rs
1768041150|Claude|A|crates/rource-core/src/scene/tree.rs
1768041150|Claude|A|crates/rource-core/src/scene/user.rs
1768041150|Claude|M|crates/rource-math/src/color.rs
1768041150|Claude|M|crates/rource-math/src/mat4.rs
1768041150|Claude|M|crates/rource-vcs/src/commit.rs
1768041150|Claude|M|crates/rource-vcs/src/detect.rs
1768041150|Claude|M|crates/rource-vcs/src/parser/custom.rs
1768041150|Claude|M|crates/rource-vcs/src/parser/git.rs
1768041150|Claude|M|crates/rource-vcs/src/parser/mod.rs
1768042447|Claude|M|CLAUDE.md
1768042447|Claude|A|crates/rource-core/src/animation/mod.rs
1768042447|Claude|A|crates/rource-core/src/animation/spline.rs
1768042447|Claude|A|crates/rource-core/src/animation/tween.rs
1768042447|Claude|A|crates/rource-core/src/camera/mod.rs
1768042447|Claude|M|crates/rource-core/src/lib.rs
1768042447|Claude|A|crates/rource-core/src/physics/force.rs
1768042447|Claude|M|crates/rource-core/src/physics/mod.rs
1768042602|Claude|M|GOURCE_RUST_REWRITE_PLAN.md
1768044097|Claude|M|CLAUDE.md
1768044097|Claude|M|Cargo.toml
1768044097|Claude|M|crates/rource-core/src/physics/force.rs
1768044097|Claude|A|crates/rource-render/Cargo.toml
1768044097|Claude|A|crates/rource-render/src/backend/mod.rs
1768044097|Claude|A|crates/rource-render/src/backend/software.rs
1768044097|Claude|A|crates/rource-render/src/command.rs
1768044097|Claude|A|crates/rource-render/src/effects/bloom.rs
1768044097|Claude|A|crates/rource-render/src/effects/mod.rs
1768044097|Claude|A|crates/rource-render/src/font.rs
1768044097|Claude|A|crates/rource-render/src/lib.rs
1768044097|Claude|A|crates/rource-render/src/texture.rs
1768045302|Claude|M|CLAUDE.md
1768045302|Claude|M|Cargo.toml
1768045302|Claude|M|crates/rource-render/src/backend/software.rs
1768045302|Claude|M|crates/rource-render/src/command.rs
1768045302|Claude|M|crates/rource-render/src/effects/bloom.rs
1768045302|Claude|M|crates/rource-render/src/font.rs
1768045302|Claude|M|crates/rource-render/src/texture.rs
1768045302|Claude|A|rource-cli/Cargo.toml
1768045302|Claude|A|rource-cli/src/args.rs
1768045302|Claude|A|rource-cli/src/main.rs
1768046181|Claude|M|rource-cli/src/main.rs
1768046358|Claude|M|GOURCE_RUST_REWRITE_PLAN.md
1768047064|Claude|A|crates/rource-core/src/config/mod.rs
1768047064|Claude|A|crates/rource-core/src/config/settings.rs
1768047064|Claude|M|crates/rource-core/src/lib.rs
1768047064|Claude|M|crates/rource-core/src/scene/mod.rs
1768047064|Claude|M|rource-cli/src/main.rs
1768047369|Claude|M|crates/rource-render/src/effects/mod.rs
1768047369|Claude|A|crates/rource-render/src/effects/shadow.rs
1768047369|Claude|M|rource-cli/src/args.rs
1768047369|Claude|M|rource-cli/src/main.rs
1768047841|Claude|M|crates/rource-vcs/src/detect.rs
1768047841|Claude|M|crates/rource-vcs/src/parser/mod.rs
1768047841|Claude|A|crates/rource-vcs/src/parser/svn.rs
1768047991|Claude|M|CLAUDE.md
1768047991|Claude|M|GOURCE_RUST_REWRITE_PLAN.md
1768049940|Claude|M|CLAUDE.md
1768049940|Claude|M|crates/rource-core/src/config/settings.rs
1768049940|Claude|M|crates/rource-core/src/scene/mod.rs
1768049940|Claude|A|crates/rource-render/assets/RobotoMono-Regular.ttf
1768049940|Claude|M|crates/rource-render/src/backend/software.rs
1768049940|Claude|A|crates/rource-render/src/default_font.rs
1768049940|Claude|M|crates/rource-render/src/effects/shadow.rs
1768049940|Claude|M|crates/rource-render/src/lib.rs
1768049940|Claude|M|crates/rource-vcs/src/parser/svn.rs
1768049940|Claude|M|rource-cli/src/main.rs
1768061605|Claude|M|CLAUDE.md
1768061605|Claude|M|rource-cli/src/args.rs
1768061605|Claude|M|rource-cli/src/main.rs
1768062405|Claude|M|CLAUDE.md
1768062405|Claude|M|rource-cli/src/args.rs
1768062405|Claude|A|rource-cli/src/export.rs
1768062405|Claude|M|rource-cli/src/main.rs
1768064101|Claude|M|crates/rource-core/src/scene/mod.rs
1768064101|Claude|M|rource-cli/src/main.rs
1768064892|Claude|M|CLAUDE.md
1768064892|Claude|M|GOURCE_RUST_REWRITE_PLAN.md
1768066271|Claude|M|Cargo.toml
1768066271|Claude|M|rource-cli/src/main.rs
1768066271|Claude|A|rource-wasm/Cargo.toml
1768066271|Claude|A|rource-wasm/src/lib.rs
1768066271|Claude|A|rource-wasm/www/index.html
1768066271|Claude|A|scripts/build-wasm.sh
1768066342|Claude|M|CLAUDE.md
1768068930|Claude|M|crates/rource-vcs/src/detect.rs
1768068930|Claude|A|crates/rource-vcs/src/parser/mercurial.rs
1768068930|Claude|M|crates/rource-vcs/src/parser/mod.rs
1768068930|Claude|M|rource-cli/Cargo.toml
1768068930|Claude|M|rource-cli/src/args.rs
1768068930|Claude|M|rource-cli/src/export.rs
1768068930|Claude|M|rource-cli/src/main.rs
1768068930|Claude|M|rource-wasm/src/lib.rs
1768068930|Claude|M|rource-wasm/www/index.html
1768070585|Claude|M|crates/rource-vcs/src/detect.rs
1768070585|Claude|A|crates/rource-vcs/src/parser/bazaar.rs
1768070585|Claude|M|crates/rource-vcs/src/parser/mercurial.rs
1768070585|Claude|M|crates/rource-vcs/src/parser/mod.rs
1768070585|Claude|M|rource-cli/src/export.rs
1768070585|Claude|M|rource-cli/src/main.rs
1768070585|Claude|M|rource-wasm/src/lib.rs
1768070585|Claude|M|rource-wasm/www/index.html
1768079256|Claude|M|crates/rource-core/src/scene/mod.rs
1768079256|Claude|M|rource-cli/src/main.rs
1768082290|Claude|M|Cargo.toml
1768082290|Claude|M|GOURCE_RUST_REWRITE_PLAN.md
1768082290|Claude|M|crates/rource-core/Cargo.toml
1768082290|Claude|A|crates/rource-core/src/config/config_file.rs
1768082290|Claude|M|crates/rource-core/src/config/mod.rs
1768082290|Claude|M|crates/rource-core/src/scene/mod.rs
1768082290|Claude|M|crates/rource-render/src/backend/software.rs
1768082290|Claude|M|rource-cli/Cargo.toml
1768082290|Claude|M|rource-cli/src/args.rs
1768082290|Claude|A|rource-cli/src/avatar.rs
1768082290|Claude|M|rource-cli/src/main.rs
1768082688|Claude|M|GOURCE_RUST_REWRITE_PLAN.md
1768084344|Claude|M|crates/rource-core/Cargo.toml
1768084344|Claude|M|crates/rource-core/src/config/config_file.rs
1768084344|Claude|M|crates/rource-core/src/config/mod.rs
1768084344|Claude|M|crates/rource-core/src/config/settings.rs
1768084344|Claude|M|rource-cli/src/args.rs
1768084344|Claude|M|rource-cli/src/main.rs
1768087702|Claude|M|crates/rource-core/src/scene/mod.rs
1768087702|Claude|M|rource-cli/src/main.rs
1768088628|Claude|M|CLAUDE.md
1768088628|Claude|M|GOURCE_RUST_REWRITE_PLAN.md
1768088628|Claude|A|crates/rource-core/src/config/config_env.rs
1768088628|Claude|M|crates/rource-core/src/config/mod.rs
1768088628|Claude|M|rource-cli/src/args.rs
1768088628|Claude|M|rource-cli/src/main.rs
1768088835|Claude|M|rource-cli/src/args.rs
1768088835|Claude|M|rource-cli/src/main.rs
1768088917|Claude|M|GOURCE_RUST_REWRITE_PLAN.md
1768091184|Claude|A|MIGRATING.md
1768091184|Claude|M|README.md
1768091184|Claude|A|examples/README.md
1768091184|Claude|A|examples/basic.toml
1768091184|Claude|A|examples/export-video.sh
1768091184|Claude|A|examples/large-repo.toml
1768091184|Claude|A|examples/minimal.toml
1768091184|Claude|A|examples/presentation.toml
1768091184|Claude|A|examples/quick-preview.sh
1768091184|Claude|A|examples/rust-project.toml
1768091184|Claude|A|examples/sample-custom.log
1768091184|Claude|A|examples/video-export.toml
1768091184|Claude|A|examples/web-project.toml
1768091218|Claude|M|GOURCE_RUST_REWRITE_PLAN.md
1768092822|Claude|M|CLAUDE.md
1768092822|Claude|M|README.md
1768092822|Claude|M|crates/rource-render/Cargo.toml
1768092822|Claude|M|crates/rource-render/src/backend/mod.rs
1768092822|Claude|A|crates/rource-render/src/backend/webgl2/buffers.rs
1768092822|Claude|A|crates/rource-render/src/backend/webgl2/mod.rs
1768092822|Claude|A|crates/rource-render/src/backend/webgl2/shaders.rs
1768092822|Claude|A|crates/rource-render/src/backend/webgl2/textures.rs
1768092822|Claude|M|crates/rource-render/src/lib.rs
1768092822|Claude|M|rource-wasm/Cargo.toml
1768092822|Claude|M|rource-wasm/src/lib.rs
1768093056|Claude|M|GOURCE_RUST_REWRITE_PLAN.md
1768094482|Claude|M|GOURCE_RUST_REWRITE_PLAN.md
1768094482|Claude|M|crates/rource-core/src/config/config_env.rs
1768094482|Claude|M|crates/rource-core/src/config/settings.rs
1768094482|Claude|M|crates/rource-core/src/scene/mod.rs
1768094482|Claude|M|crates/rource-render/src/backend/mod.rs
1768094482|Claude|M|crates/rource-render/src/backend/webgl2/textures.rs
1768094482|Claude|M|crates/rource-vcs/src/detect.rs
1768094482|Claude|M|crates/rource-vcs/src/lib.rs
1768094482|Claude|M|crates/rource-vcs/src/parser/bazaar.rs
1768094482|Claude|M|crates/rource-vcs/src/parser/mercurial.rs
1768094482|Claude|M|rource-cli/src/args.rs
1768094482|Claude|M|rource-cli/src/avatar.rs
1768094482|Claude|M|rource-cli/src/main.rs
1768094482|Claude|M|rource-wasm/src/lib.rs
1768129122|Claude|M|CLAUDE.md
1768129122|Claude|M|GOURCE_RUST_REWRITE_PLAN.md
1768129122|Claude|A|crates/rource-vcs/examples/memory_benchmark.rs
1768129122|Claude|A|crates/rource-vcs/src/compact.rs
1768129122|Claude|A|crates/rource-vcs/src/intern.rs
1768129122|Claude|M|crates/rource-vcs/src/lib.rs
1768129122|Claude|A|crates/rource-vcs/src/stream.rs
1768135084|Claude|M|crates/rource-core/src/config/config_env.rs
1768135084|Claude|M|crates/rource-core/src/config/config_file.rs
1768135084|Claude|M|crates/rource-core/src/config/mod.rs
1768135084|Claude|M|crates/rource-core/src/config/settings.rs
1768135084|Claude|M|rource-cli/src/args.rs
1768135084|Claude|M|rource-cli/src/main.rs
1768137496|Claude|A|crates/rource-core/src/camera/camera3d.rs
1768137496|Claude|M|crates/rource-core/src/camera/mod.rs
1768137496|Claude|M|crates/rource-core/src/config/config_env.rs
1768137496|Claude|M|crates/rource-core/src/config/config_file.rs
1768137496|Claude|M|crates/rource-core/src/config/settings.rs
1768137496|Claude|M|crates/rource-core/src/lib.rs
1768137496|Claude|M|crates/rource-render/Cargo.toml
1768137496|Claude|M|crates/rource-render/src/backend/software.rs
1768137496|Claude|M|crates/rource-render/src/backend/webgl2/shaders.rs
1768137496|Claude|A|crates/rource-render/src/image.rs
1768137496|Claude|M|crates/rource-render/src/lib.rs
1768137496|Claude|M|crates/rource-vcs/src/compact.rs
1768137496|Claude|M|crates/rource-vcs/src/intern.rs
1768137496|Claude|M|crates/rource-vcs/src/stream.rs
1768137496|Claude|M|rource-cli/src/args.rs
1768137496|Claude|M|rource-cli/src/main.rs
1768137496|Claude|M|rource-wasm/src/lib.rs
1768145880|Claude|A|benchmarks/.gitignore
1768145880|Claude|A|benchmarks/BENCHMARK_REPORT.md
1768145880|Claude|A|benchmarks/docs/BENCHMARK_METHODOLOGY.md
1768145880|Claude|A|benchmarks/scripts/benchmark_binary.sh
1768145880|Claude|A|benchmarks/scripts/benchmark_features.sh
1768145880|Claude|A|benchmarks/scripts/benchmark_log_parsing.sh
1768145880|Claude|A|benchmarks/scripts/benchmark_memory.sh
1768145880|Claude|A|benchmarks/scripts/benchmark_rendering.sh
1768145880|Claude|A|benchmarks/scripts/common.sh
1768145880|Claude|A|benchmarks/scripts/run_benchmarks.sh
1768145880|Claude|A|benchmarks/scripts/test_benchmarks.sh
1768146249|Claude|A|.github/workflows/deploy-pages.yml
1768146249|Claude|A|rource-wasm/www/.nojekyll
1768147375|Claude|M|.github/workflows/deploy-pages.yml
1768147375|Claude|M|rource-wasm/www/index.html
1768147471|Claude|M|README.md
1768147773|Claude|M|.github/workflows/deploy-pages.yml
1768150459|Claude|M|rource-wasm/www/index.html
1768151357|Claude|M|crates/rource-core/src/scene/mod.rs
1768151357|Claude|M|crates/rource-core/src/scene/user.rs
1768151357|Claude|M|rource-wasm/www/index.html
1768152039|Claude|M|rource-wasm/src/lib.rs
1768152039|Claude|M|rource-wasm/www/index.html
1768153285|Claude|M|rource-wasm/src/lib.rs
1768153285|Claude|M|rource-wasm/www/index.html
1768153285|Claude|A|rource-wasm/www/pkg/package.json
1768153285|Claude|A|rource-wasm/www/pkg/rource_wasm.d.ts
1768153285|Claude|A|rource-wasm/www/pkg/rource_wasm.js
1768153285|Claude|A|rource-wasm/www/pkg/rource_wasm_bg.wasm
1768153285|Claude|A|rource-wasm/www/pkg/rource_wasm_bg.wasm.d.ts`;

        // Pre-calculate stats for the cached Rource data
        const ROURCE_STATS = (() => {
            const lines = ROURCE_CACHED_DATA.split('\n');
            const files = new Set();
            const authors = new Set();
            let commits = 0;
            for (const line of lines) {
                if (!line.trim()) continue;
                const parts = line.split('|');
                if (parts.length >= 4) {
                    commits++;
                    authors.add(parts[1].trim());
                    files.add(parts[3].trim());
                }
            }
            return { commits, files: files.size, authors: authors.size };
        })();

        // Demo data - more comprehensive project evolution
        const DEMO_DATA = `1704067200|Alice|A|src/main.rs
1704067260|Alice|A|src/lib.rs
1704067320|Alice|A|Cargo.toml
1704067380|Alice|A|README.md
1704153600|Bob|A|src/config.rs
1704153660|Bob|M|src/main.rs
1704153720|Bob|A|src/utils/mod.rs
1704153780|Bob|A|src/utils/helpers.rs
1704240000|Charlie|A|tests/test_main.rs
1704240060|Charlie|M|src/lib.rs
1704240120|Charlie|A|tests/test_config.rs
1704326400|Alice|M|src/main.rs
1704326460|Alice|M|src/config.rs
1704326520|Alice|A|docs/API.md
1704412800|Bob|A|src/api/mod.rs
1704412860|Bob|A|src/api/routes.rs
1704412920|Bob|A|src/api/handlers.rs
1704412980|Bob|M|src/main.rs
1704499200|Charlie|A|src/db/mod.rs
1704499260|Charlie|A|src/db/models.rs
1704499320|Charlie|A|src/db/queries.rs
1704499380|Charlie|M|src/api/handlers.rs
1704585600|Alice|A|src/auth/mod.rs
1704585660|Alice|A|src/auth/jwt.rs
1704585720|Alice|M|src/api/routes.rs
1704585780|Alice|A|tests/test_auth.rs
1704672000|Bob|M|src/db/queries.rs
1704672060|Bob|M|src/api/handlers.rs
1704672120|Bob|A|migrations/001_initial.sql
1704758400|Charlie|A|.github/workflows/ci.yml
1704758460|Charlie|M|Cargo.toml
1704758520|Charlie|A|Dockerfile
1704844800|Alice|M|README.md
1704844860|Alice|A|docs/DEPLOY.md
1704844920|Alice|M|src/main.rs
1704931200|Bob|D|src/utils/helpers.rs
1704931260|Bob|A|src/utils/string.rs
1704931320|Bob|A|src/utils/time.rs
1704931380|Bob|M|src/utils/mod.rs
1705017600|Charlie|M|src/auth/jwt.rs
1705017660|Charlie|A|src/auth/middleware.rs
1705017720|Charlie|M|src/api/routes.rs
1705104000|Diana|A|frontend/index.html
1705104060|Diana|A|frontend/style.css
1705104120|Diana|A|frontend/app.js
1705190400|Eve|A|src/cache/mod.rs
1705190460|Eve|A|src/cache/redis.rs
1705190520|Eve|M|src/api/handlers.rs`;

        // DOM elements
        const canvas = document.getElementById('canvas');
        const btnPlay = document.getElementById('btn-play');
        const playIcon = document.getElementById('play-icon');
        const playText = document.getElementById('play-text');
        const btnPlaySmall = document.getElementById('btn-play-small');
        const playIconSmall = document.getElementById('play-icon-small');
        const btnPrev = document.getElementById('btn-prev');
        const btnNext = document.getElementById('btn-next');
        const btnReset = document.getElementById('btn-reset');
        const btnLabels = document.getElementById('btn-labels');
        const labelsText = document.getElementById('labels-text');
        const btnLoad = document.getElementById('btn-load');
        const btnLoadFile = document.getElementById('btn-load-file');
        const btnCopyCommand = document.getElementById('btn-copy-command');
        const btnFetchGithub = document.getElementById('btn-fetch-github');
        const githubUrlInput = document.getElementById('github-url');
        const fetchStatus = document.getElementById('fetch-status');
        const fetchStatusText = document.getElementById('fetch-status-text');
        const fetchProgressBar = document.getElementById('fetch-progress-bar');
        const logInput = document.getElementById('log-input');
        const loadingEl = document.getElementById('loading');
        const timelineSlider = document.getElementById('timeline-slider');
        const timelineInfo = document.getElementById('timeline-info');
        const speedSelect = document.getElementById('speed-select');
        const fileInput = document.getElementById('file-input');
        const fileDropZone = document.getElementById('file-drop-zone');
        const fileNameEl = document.getElementById('file-name');
        const emptyState = document.getElementById('empty-state');
        const rendererBadge = document.getElementById('renderer-badge');
        const statsOverlay = document.getElementById('stats-overlay');
        const statCommits = document.getElementById('stat-commits');
        const statFiles = document.getElementById('stat-files');
        const statAuthors = document.getElementById('stat-authors');
        const toast = document.getElementById('toast');

        // Performance metrics DOM elements
        const perfOverlay = document.getElementById('perf-overlay');
        const perfFps = document.getElementById('perf-fps');
        const perfFrameTime = document.getElementById('perf-frame-time');
        const perfEntities = document.getElementById('perf-entities');
        const perfVisible = document.getElementById('perf-visible');
        const perfDraws = document.getElementById('perf-draws');
        const perfResolution = document.getElementById('perf-resolution');
        const techRenderer = document.getElementById('tech-renderer');

        // Showcase panel DOM elements
        const btnVisualizeRource = document.getElementById('btn-visualize-rource');
        const showcaseCommits = document.getElementById('showcase-commits');
        const showcaseFiles = document.getElementById('showcase-files');
        const showcaseAuthors = document.getElementById('showcase-authors');

        // Authors legend DOM elements
        const authorsPanel = document.getElementById('authors-panel');
        const authorsItems = document.getElementById('authors-items');
        const authorsToggle = document.getElementById('authors-toggle');

        // Toast notification
        function showToast(message, type = 'error', duration = 5000) {
            toast.querySelector('.toast-message').textContent = message;
            toast.className = `toast ${type} visible`;
            setTimeout(() => toast.classList.remove('visible'), duration);
        }

        toast.querySelector('.toast-close').addEventListener('click', () => {
            toast.classList.remove('visible');
        });

        // Resize canvas
        function resizeCanvas() {
            const container = document.getElementById('canvas-container');
            const rect = container.getBoundingClientRect();
            const width = Math.floor(rect.width);
            const height = Math.floor(rect.height);

            if (canvas.width !== width || canvas.height !== height) {
                canvas.width = width;
                canvas.height = height;
                if (rource) {
                    rource.resize(width, height);
                    rource.forceRender();
                }
            }
        }

        // Performance metrics update counter (update every N frames for performance)
        let perfUpdateCounter = 0;
        const PERF_UPDATE_INTERVAL = 10; // Update every 10 frames

        // Animation loop
        function animate(timestamp) {
            if (rource) {
                rource.frame(timestamp);
                updateUI();

                // Update performance metrics periodically
                perfUpdateCounter++;
                if (perfUpdateCounter >= PERF_UPDATE_INTERVAL) {
                    updatePerfMetrics();
                    perfUpdateCounter = 0;
                }
            }
            animationId = requestAnimationFrame(animate);
        }

        // Update performance metrics overlay
        function updatePerfMetrics() {
            if (!rource || !hasLoadedData) return;

            try {
                // Get FPS and frame time
                const fps = rource.getFps();
                const frameTimeMs = rource.getFrameTimeMs();

                // Get render statistics
                const totalEntities = rource.getTotalEntities();
                const visibleFiles = rource.getVisibleFiles();
                const visibleUsers = rource.getVisibleUsers();
                const visibleDirs = rource.getVisibleDirectories();
                const drawCalls = rource.getDrawCalls();
                const width = rource.getCanvasWidth();
                const height = rource.getCanvasHeight();

                // Update FPS display with color coding
                const fpsRounded = Math.round(fps);
                perfFps.textContent = `${fpsRounded} FPS`;
                perfFps.className = 'perf-fps ' + (fpsRounded >= 55 ? 'good' : fpsRounded >= 30 ? 'ok' : 'bad');

                // Update other metrics
                perfFrameTime.textContent = `${frameTimeMs.toFixed(1)}ms`;
                perfEntities.textContent = totalEntities.toLocaleString();
                perfVisible.textContent = `${visibleFiles + visibleUsers + visibleDirs}`;
                perfDraws.textContent = drawCalls.toString();
                perfResolution.textContent = `${width}${height}`;
            } catch (e) {
                // Silently ignore errors if methods don't exist
            }
        }

        // Update UI
        function updateUI() {
            if (!rource) return;

            const playing = rource.isPlaying();
            const total = rource.commitCount();
            const current = rource.currentCommit();

            // Update play buttons
            const pauseIcon = '<rect x="6" y="4" width="4" height="16"/><rect x="14" y="4" width="4" height="16"/>';
            const playIconPath = '<path d="M8 5v14l11-7z"/>';

            playText.textContent = playing ? 'Pause' : 'Play';
            playIcon.innerHTML = playing ? pauseIcon : playIconPath;
            playIconSmall.innerHTML = playing ? pauseIcon : playIconPath;

            if (playing) {
                btnPlaySmall.classList.add('active');
            } else {
                btnPlaySmall.classList.remove('active');
            }

            // Update timeline
            if (total > 0) {
                timelineSlider.max = total - 1;
                timelineSlider.value = Math.min(current, total - 1);
                timelineSlider.disabled = false;
                timelineInfo.textContent = `${Math.min(current + 1, total)} / ${total}`;
            } else {
                timelineSlider.max = 0;
                timelineSlider.value = 0;
                timelineSlider.disabled = true;
                timelineInfo.textContent = '0 / 0';
            }
        }

        // Analyze log data for stats
        function analyzeLogData(content) {
            const lines = content.split('\n');
            const files = new Set();
            const authors = new Set();
            let commits = 0;

            for (const line of lines) {
                if (!line.trim()) continue;
                const parts = line.split('|');
                if (parts.length >= 4) {
                    commits++;
                    authors.add(parts[1].trim());
                    files.add(parts[3].trim());
                }
            }

            return { commits, files: files.size, authors };
        }

        // Load log data
        function loadLogData(content, format = 'custom') {
            if (!rource || !content.trim()) {
                showToast('Please enter or upload log data first.', 'error');
                return;
            }

            try {
                let count;
                if (format === 'git') {
                    count = rource.loadGitLog(content);
                } else {
                    count = rource.loadCustomLog(content);
                }

                if (count === 0) {
                    showToast('No commits found. Check your log format.', 'error');
                    return;
                }

                // Analyze data
                const stats = analyzeLogData(content);
                statCommits.textContent = count;
                statFiles.textContent = stats.files;
                statAuthors.textContent = stats.authors.size;

                hasLoadedData = true;
                emptyState.classList.add('hidden');
                statsOverlay.classList.remove('hidden');
                perfOverlay.classList.remove('hidden');

                // Enable controls
                btnPrev.disabled = false;
                btnNext.disabled = false;
                speedSelect.disabled = false;

                updateUI();
                updateLegend(content);
                updateAuthorsLegend(content);
                updatePerfMetrics();
                showToast(`Loaded ${count} commits from ${stats.authors.size} authors!`, 'success', 3000);

                // Auto-play
                rource.play();
                updateUI();

            } catch (e) {
                showToast(`Failed to parse log: ${e}`, 'error');
                console.error('Parse error:', e);
            }
        }

        // Extension colors (matches Rust code)
        const extensionColors = {
            'rs': '#dea584', 'go': '#00add8', 'py': '#3572a5',
            'js': '#f7df1e', 'ts': '#3178c6', 'jsx': '#61dafb', 'tsx': '#61dafb',
            'java': '#b07219', 'kt': '#a78bfa', 'c': '#5555ff', 'cpp': '#00599c',
            'cs': '#9b4f96', 'rb': '#cc342d', 'php': '#4f5d95', 'swift': '#f05138',
            'html': '#e34c26', 'css': '#563d7c', 'scss': '#cd6799',
            'json': '#808080', 'yaml': '#cb171e', 'yml': '#cb171e',
            'toml': '#9c4221', 'xml': '#0060ac', 'md': '#083fa1',
            'sh': '#008000', 'sql': '#e38c00', 'dockerfile': '#2496ed'
        };

        function getExtensionColor(ext) {
            const lower = ext.toLowerCase();
            if (extensionColors[lower]) return extensionColors[lower];
            // Hash for unknown extensions
            let hash = 0;
            for (let i = 0; i < lower.length; i++) {
                hash = (hash * 31 + lower.charCodeAt(i)) >>> 0;
            }
            return `hsl(${hash % 360}, 50%, 50%)`;
        }

        // Update legend
        function updateLegend(content) {
            const legendItems = document.getElementById('legend-items');
            const extensionCounts = {};

            const lines = content.split('\n');
            for (const line of lines) {
                const parts = line.split('|');
                if (parts.length >= 4) {
                    const path = parts[3].trim();
                    const dotIdx = path.lastIndexOf('.');
                    if (dotIdx > 0 && dotIdx < path.length - 1) {
                        const ext = path.substring(dotIdx + 1).toLowerCase();
                        if (ext.length <= 10) {
                            extensionCounts[ext] = (extensionCounts[ext] || 0) + 1;
                        }
                    }
                }
            }

            const sorted = Object.entries(extensionCounts)
                .sort((a, b) => b[1] - a[1])
                .slice(0, 12);

            legendItems.innerHTML = sorted.map(([ext, count]) => {
                const color = getExtensionColor(ext);
                return `<div class="legend-item" role="listitem">
                    <span class="legend-color" style="background: ${color}"></span>
                    <span class="legend-ext">.${ext}</span>
                    <span class="legend-count">${count}</span>
                </div>`;
            }).join('');

            if (sorted.length > 0) {
                document.getElementById('legend-panel').classList.remove('collapsed');
                document.getElementById('legend-toggle').setAttribute('aria-expanded', 'true');
            }
        }

        // Legend toggle
        const legendToggle = document.getElementById('legend-toggle');
        legendToggle.addEventListener('click', () => {
            const panel = document.getElementById('legend-panel');
            panel.classList.toggle('collapsed');
            const isExpanded = !panel.classList.contains('collapsed');
            legendToggle.setAttribute('aria-expanded', isExpanded.toString());
        });

        // =====================================================================
        // AUTHORS LEGEND
        // =====================================================================
        // Updates the authors legend panel with contributors and their colors.
        // Uses the WASM getAuthors() API to get accurate color assignments.
        // =====================================================================
        function updateAuthorsLegend(content) {
            if (!rource) return;

            // Parse author data from log content first (before WASM is populated)
            const authorCommits = {};
            const lines = content.split('\n');
            for (const line of lines) {
                if (!line.trim()) continue;
                const parts = line.split('|');
                if (parts.length >= 4) {
                    const author = parts[1].trim();
                    authorCommits[author] = (authorCommits[author] || 0) + 1;
                }
            }

            // Sort by commit count descending
            const sorted = Object.entries(authorCommits)
                .sort((a, b) => b[1] - a[1])
                .slice(0, 10); // Show top 10 authors

            if (sorted.length === 0) return;

            // Build the authors items HTML
            authorsItems.innerHTML = sorted.map(([name, commits]) => {
                // Get color from WASM (deterministic based on name hash)
                let color;
                try {
                    color = rource.getAuthorColor(name);
                } catch (e) {
                    // Fallback color generation if WASM method isn't available
                    let hash = 0;
                    for (let i = 0; i < name.length; i++) {
                        hash = (hash * 31 + name.charCodeAt(i)) >>> 0;
                    }
                    color = `hsl(${hash % 360}, 60%, 55%)`;
                }
                // Escape HTML in name
                const escapedName = name.replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;');
                return `<div class="author-item" role="listitem" title="${escapedName} - ${commits} commits">
                    <span class="author-color" style="background: ${color}"></span>
                    <span class="author-name">${escapedName}</span>
                    <span class="author-commits">${commits}</span>
                </div>`;
            }).join('');

            // Show the authors panel
            authorsPanel.classList.remove('hidden');
            authorsPanel.classList.remove('collapsed');
            authorsToggle.setAttribute('aria-expanded', 'true');
        }

        // Authors legend toggle
        authorsToggle.addEventListener('click', () => {
            authorsPanel.classList.toggle('collapsed');
            const isExpanded = !authorsPanel.classList.contains('collapsed');
            authorsToggle.setAttribute('aria-expanded', isExpanded.toString());
        });

        // Keyboard shortcuts for authors panel (A key)
        document.addEventListener('keydown', (e) => {
            if (e.target.tagName === 'TEXTAREA' || e.target.tagName === 'INPUT') return;
            if (e.key === 'a' || e.key === 'A') {
                if (hasLoadedData && !authorsPanel.classList.contains('hidden')) {
                    authorsPanel.classList.toggle('collapsed');
                    const isExpanded = !authorsPanel.classList.contains('collapsed');
                    authorsToggle.setAttribute('aria-expanded', isExpanded.toString());
                }
            }
        });

        // Performance overlay toggle
        const perfToggle = document.getElementById('perf-toggle');
        perfToggle.addEventListener('click', () => {
            perfOverlay.classList.toggle('collapsed');
            const isExpanded = !perfOverlay.classList.contains('collapsed');
            perfToggle.setAttribute('aria-expanded', isExpanded.toString());
        });

        // Keyboard shortcut for performance overlay (P key)
        document.addEventListener('keydown', (e) => {
            if (e.target.tagName === 'TEXTAREA' || e.target.tagName === 'INPUT') return;
            if (e.key === 'p' || e.key === 'P') {
                if (hasLoadedData) {
                    perfOverlay.classList.toggle('hidden');
                }
            }
        });

        // GitHub API rate limit tracking
        let rateLimitRemaining = 60;
        let rateLimitReset = 0;

        // Cache for fetched repos (uses localStorage)
        const CACHE_KEY = 'rource_github_cache';
        const CACHE_EXPIRY = 24 * 60 * 60 * 1000; // 24 hours

        function getCache() {
            try {
                const cached = localStorage.getItem(CACHE_KEY);
                if (cached) {
                    const data = JSON.parse(cached);
                    // Clean expired entries
                    const now = Date.now();
                    for (const key of Object.keys(data)) {
                        if (data[key].timestamp < now - CACHE_EXPIRY) {
                            delete data[key];
                        }
                    }
                    return data;
                }
            } catch (e) { /* ignore */ }
            return {};
        }

        function setCache(key, logContent) {
            try {
                const cache = getCache();
                cache[key] = { logContent, timestamp: Date.now() };
                localStorage.setItem(CACHE_KEY, JSON.stringify(cache));
            } catch (e) { /* ignore quota errors */ }
        }

        function getCachedRepo(owner, repo) {
            const cache = getCache();
            const key = `${owner}/${repo}`;
            if (cache[key] && cache[key].timestamp > Date.now() - CACHE_EXPIRY) {
                return cache[key].logContent;
            }
            return null;
        }

        // Check rate limit before making requests
        async function checkRateLimit() {
            try {
                const response = await fetch('https://api.github.com/rate_limit', {
                    headers: { 'Accept': 'application/vnd.github.v3+json' }
                });
                if (response.ok) {
                    const data = await response.json();
                    rateLimitRemaining = data.rate.remaining;
                    rateLimitReset = data.rate.reset * 1000;
                    return rateLimitRemaining;
                }
            } catch (e) { /* ignore */ }
            return rateLimitRemaining;
        }

        function formatTimeUntilReset() {
            const now = Date.now();
            if (rateLimitReset <= now) return 'soon';
            const minutes = Math.ceil((rateLimitReset - now) / 60000);
            return minutes === 1 ? '1 minute' : `${minutes} minutes`;
        }

        // GitHub API fetch with caching and rate limit awareness
        async function fetchGitHubRepo(repoUrl) {
            // Parse repo URL
            let owner, repo;
            try {
                const url = new URL(repoUrl.includes('://') ? repoUrl : 'https://' + repoUrl);
                const parts = url.pathname.split('/').filter(p => p);
                if (parts.length < 2) throw new Error('Invalid URL');
                owner = parts[0];
                repo = parts[1].replace('.git', '');
            } catch (e) {
                // Try simple format: owner/repo
                const parts = repoUrl.split('/').filter(p => p);
                if (parts.length >= 2) {
                    owner = parts[parts.length - 2];
                    repo = parts[parts.length - 1].replace('.git', '');
                } else {
                    throw new Error('Invalid repository URL. Use format: owner/repo or https://github.com/owner/repo');
                }
            }

            // Check cache first
            const cachedContent = getCachedRepo(owner, repo);
            if (cachedContent) {
                fetchStatus.className = 'fetch-status visible success';
                fetchStatusText.textContent = `Loaded ${owner}/${repo} from cache!`;
                fetchProgressBar.style.width = '100%';
                loadLogData(cachedContent, 'custom');
                return;
            }

            // Check rate limit before proceeding
            const remaining = await checkRateLimit();
            if (remaining < 5) {
                throw new Error(`GitHub API rate limit low (${remaining} requests left). Resets in ${formatTimeUntilReset()}. Try a cached repo or wait.`);
            }

            fetchStatus.className = 'fetch-status visible loading';
            fetchStatusText.textContent = `Fetching commits from ${owner}/${repo}... (${remaining} API calls remaining)`;
            fetchProgressBar.style.width = '10%';

            // Limit commits based on available rate limit (each commit needs 1 API call for details)
            const maxDetailedCommits = Math.min(50, Math.floor(remaining * 0.8)); // Use 80% of remaining, max 50

            try {
                // Fetch commit list (single API call for many commits)
                const response = await fetch(
                    `https://api.github.com/repos/${owner}/${repo}/commits?per_page=100`,
                    { headers: { 'Accept': 'application/vnd.github.v3+json' } }
                );

                // Update rate limit from response headers
                const limitHeader = response.headers.get('X-RateLimit-Remaining');
                if (limitHeader) rateLimitRemaining = parseInt(limitHeader, 10);

                if (!response.ok) {
                    if (response.status === 404) {
                        throw new Error('Repository not found. Make sure it exists and is public.');
                    } else if (response.status === 403) {
                        const resetHeader = response.headers.get('X-RateLimit-Reset');
                        if (resetHeader) rateLimitReset = parseInt(resetHeader, 10) * 1000;
                        throw new Error(`GitHub API rate limit exceeded. Resets in ${formatTimeUntilReset()}.`);
                    }
                    throw new Error(`GitHub API error: ${response.status}`);
                }

                const commits = await response.json();
                if (commits.length === 0) {
                    throw new Error('No commits found in this repository.');
                }

                fetchProgressBar.style.width = '20%';
                fetchStatusText.textContent = `Found ${commits.length} commits. Fetching file details (limited to ${maxDetailedCommits} to preserve API quota)...`;

                const logLines = [];
                const limitedCommits = commits.slice(0, maxDetailedCommits);
                let fetchedCount = 0;
                let skippedDueToRateLimit = 0;

                for (let i = 0; i < limitedCommits.length; i++) {
                    // Check if we're running low on rate limit
                    if (rateLimitRemaining < 3) {
                        skippedDueToRateLimit = limitedCommits.length - i;
                        break;
                    }

                    const commit = limitedCommits[i];
                    const timestamp = Math.floor(new Date(commit.commit.author.date).getTime() / 1000);
                    const author = commit.commit.author.name || 'Unknown';

                    // Fetch commit details for file changes
                    try {
                        const detailResponse = await fetch(commit.url, {
                            headers: { 'Accept': 'application/vnd.github.v3+json' }
                        });

                        // Update rate limit
                        const limitHeader = detailResponse.headers.get('X-RateLimit-Remaining');
                        if (limitHeader) rateLimitRemaining = parseInt(limitHeader, 10);

                        if (detailResponse.status === 403) {
                            skippedDueToRateLimit = limitedCommits.length - i;
                            break;
                        }

                        if (detailResponse.ok) {
                            const detail = await detailResponse.json();
                            if (detail.files) {
                                for (const file of detail.files.slice(0, 50)) {
                                    let action = 'M';
                                    if (file.status === 'added') action = 'A';
                                    else if (file.status === 'removed') action = 'D';
                                    logLines.push(`${timestamp}|${author}|${action}|${file.filename}`);
                                }
                            }
                            fetchedCount++;
                        }
                    } catch (e) {
                        // Skip failed file fetches
                    }

                    // Update progress
                    fetchProgressBar.style.width = `${20 + (i / limitedCommits.length) * 70}%`;
                    fetchStatusText.textContent = `Processing commits... ${i + 1}/${limitedCommits.length} (${rateLimitRemaining} API calls left)`;

                    // Small delay to be nice to the API
                    if (i % 5 === 4) {
                        await new Promise(r => setTimeout(r, 50));
                    }
                }

                // Reverse to get chronological order
                logLines.reverse();

                if (logLines.length === 0) {
                    throw new Error('Could not fetch file changes. The repository may be empty or API limit was reached.');
                }

                // Cache the result
                const logContent = logLines.join('\n');
                setCache(`${owner}/${repo}`, logContent);

                fetchProgressBar.style.width = '100%';
                fetchStatus.className = 'fetch-status visible success';
                let statusMsg = `Loaded ${logLines.length} file changes from ${fetchedCount} commits.`;
                if (skippedDueToRateLimit > 0) {
                    statusMsg += ` (${skippedDueToRateLimit} commits skipped due to rate limit)`;
                }
                fetchStatusText.textContent = statusMsg;

                loadLogData(logContent, 'custom');

            } catch (error) {
                fetchStatus.className = 'fetch-status visible error';
                fetchStatusText.textContent = error.message;
                fetchProgressBar.style.width = '0%';
                throw error;
            }
        }

        // Initialize
        async function main() {
            try {
                await init();
                resizeCanvas();
                rource = new Rource(canvas);

                // Update renderer badge and tech panel
                const isWebGL2 = rource.isWebGL2();
                const rendererType = rource.getRendererType();
                rendererBadge.textContent = isWebGL2 ? 'WebGL2' : 'Software';
                if (isWebGL2) rendererBadge.classList.add('webgl2');
                techRenderer.textContent = isWebGL2 ? 'WebGL2' : 'CPU';

                // Enable buttons
                btnPlay.disabled = false;
                btnReset.disabled = false;
                btnLabels.disabled = false;
                btnLoad.disabled = false;
                btnFetchGithub.disabled = false;
                btnVisualizeRource.disabled = false;

                // Initialize showcase stats from pre-calculated data
                showcaseCommits.textContent = ROURCE_STATS.commits.toLocaleString();
                showcaseFiles.textContent = ROURCE_STATS.files.toLocaleString();
                showcaseAuthors.textContent = ROURCE_STATS.authors.toLocaleString();

                // Initialize labels button state
                updateLabelsButton();

                // Log technical info to console for verification
                console.log(`%c Rource Technical Info `, 'background: #e94560; color: white; font-weight: bold;');
                console.log(`  Renderer: ${rendererType}`);
                console.log(`  Canvas: ${canvas.width}${canvas.height}`);
                console.log(`  WebGL2: ${isWebGL2}`);
                console.log(`  Cached Rource Data: ${ROURCE_STATS.commits} commits, ${ROURCE_STATS.files} files, ${ROURCE_STATS.authors} authors`);

                // Start animation
                animationId = requestAnimationFrame(animate);
                loadingEl.classList.add('hidden');

                // Auto-load Rource project data by default (cached, no API limits)
                setTimeout(() => {
                    if (!hasLoadedData) {
                        loadLogData(ROURCE_CACHED_DATA, 'custom');
                        showToast('Loaded Rource project history (cached)', 'success', 3000);
                    }
                }, 1000);

            } catch (e) {
                console.error('Initialization failed:', e);
                loadingEl.querySelector('.loading-text').textContent = 'Failed to load: ' + e.message;
                showToast(`Initialization failed: ${e.message}`, 'error', 10000);
            }
        }

        // Event handlers
        btnPlay.addEventListener('click', () => {
            if (rource && hasLoadedData) {
                rource.togglePlay();
                updateUI();
            } else if (!hasLoadedData) {
                // Load Rource project data by default (cached)
                loadLogData(ROURCE_CACHED_DATA, 'custom');
            }
        });

        btnPlaySmall.addEventListener('click', () => {
            if (rource && hasLoadedData) {
                rource.togglePlay();
                updateUI();
            }
        });

        btnPrev.addEventListener('click', () => {
            if (rource) {
                rource.stepBackward();
                updateUI();
            }
        });

        btnNext.addEventListener('click', () => {
            if (rource) {
                rource.stepForward();
                updateUI();
            }
        });

        btnReset.addEventListener('click', () => {
            if (rource) rource.resetCamera();
        });

        btnLabels.addEventListener('click', () => {
            if (rource) {
                const currentState = rource.getShowLabels();
                rource.setShowLabels(!currentState);
                updateLabelsButton();
            }
        });

        function updateLabelsButton() {
            if (rource) {
                const showLabels = rource.getShowLabels();
                labelsText.textContent = showLabels ? 'Labels' : 'Labels Off';
                btnLabels.classList.toggle('active', showLabels);
            }
        }

        // =====================================================================
        // SHOWCASE: VISUALIZE ROURCE BUTTON
        // =====================================================================
        // Loads the cached Rource repository data - no API calls needed.
        // This ensures the demo always works regardless of GitHub rate limits.
        // =====================================================================
        btnVisualizeRource.addEventListener('click', () => {
            if (!rource) return;

            // Reset the visualization and load cached Rource data
            btnVisualizeRource.disabled = true;
            btnVisualizeRource.innerHTML = `
                <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor" class="spin">
                    <path d="M12 4V1L8 5l4 4V6c3.31 0 6 2.69 6 6 0 1.01-.25 1.97-.7 2.8l1.46 1.46C19.54 15.03 20 13.57 20 12c0-4.42-3.58-8-8-8zm0 14c-3.31 0-6-2.69-6-6 0-1.01.25-1.97.7-2.8L5.24 7.74C4.46 8.97 4 10.43 4 12c0 4.42 3.58 8 8 8v3l4-4-4-4v3z"/>
                </svg>
                Loading...
            `;

            // Short delay for visual feedback
            setTimeout(() => {
                loadLogData(ROURCE_CACHED_DATA, 'custom');
                btnVisualizeRource.disabled = false;
                btnVisualizeRource.innerHTML = `
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M8 5v14l11-7z"/>
                    </svg>
                    Visualize Rource
                `;
            }, 100);
        });

        btnLoad.addEventListener('click', () => {
            if (logInput.value.trim()) {
                loadLogData(logInput.value, 'custom');
            } else {
                showToast('Please paste log data first.', 'error');
            }
        });

        // Speed control
        speedSelect.addEventListener('change', () => {
            if (rource) {
                rource.setSpeed(parseFloat(speedSelect.value));
            }
        });

        // Timeline slider
        timelineSlider.addEventListener('input', () => {
            if (rource) {
                rource.pause();
                rource.seek(parseInt(timelineSlider.value, 10));
                updateUI();
            }
        });

        // GitHub fetch
        btnFetchGithub.addEventListener('click', async () => {
            const url = githubUrlInput.value.trim();
            if (!url) {
                showToast('Please enter a GitHub repository URL.', 'error');
                return;
            }

            btnFetchGithub.disabled = true;
            try {
                await fetchGitHubRepo(url);
            } catch (e) {
                console.error('Fetch error:', e);
            }
            btnFetchGithub.disabled = false;
        });

        githubUrlInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') btnFetchGithub.click();
        });

        // Popular repo chips
        document.querySelectorAll('.repo-chip').forEach(chip => {
            chip.addEventListener('click', () => {
                const repo = chip.dataset.repo;
                githubUrlInput.value = `https://github.com/${repo}`;
                btnFetchGithub.click();
            });
        });

        // Tab switching
        document.querySelectorAll('.tab-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                const tab = btn.dataset.tab;
                document.querySelectorAll('.tab-btn').forEach(b => {
                    b.classList.remove('active');
                    b.setAttribute('aria-selected', 'false');
                });
                btn.classList.add('active');
                btn.setAttribute('aria-selected', 'true');

                document.querySelectorAll('.tab-content').forEach(c => {
                    c.classList.remove('active');
                    c.setAttribute('hidden', '');
                });
                const content = document.getElementById(`tab-${tab}`);
                content.classList.add('active');
                content.removeAttribute('hidden');
            });
        });

        // File upload
        fileDropZone.addEventListener('click', () => fileInput.click());
        fileInput.addEventListener('change', (e) => {
            if (e.target.files[0]) handleFileUpload(e.target.files[0]);
        });

        fileDropZone.addEventListener('dragover', (e) => {
            e.preventDefault();
            fileDropZone.classList.add('dragover');
        });

        fileDropZone.addEventListener('dragleave', () => {
            fileDropZone.classList.remove('dragover');
        });

        fileDropZone.addEventListener('drop', (e) => {
            e.preventDefault();
            fileDropZone.classList.remove('dragover');
            if (e.dataTransfer.files[0]) handleFileUpload(e.dataTransfer.files[0]);
        });

        function handleFileUpload(file) {
            if (file.size > 10 * 1024 * 1024) {
                showToast('File too large. Maximum size is 10MB.', 'error');
                return;
            }

            fileNameEl.textContent = `${file.name} (${(file.size / 1024).toFixed(1)} KB)`;
            fileNameEl.classList.remove('hidden');

            const reader = new FileReader();
            reader.onload = (e) => {
                uploadedFileContent = e.target.result;
                btnLoadFile.disabled = false;
            };
            reader.readAsText(file);
        }

        btnLoadFile.addEventListener('click', () => {
            if (uploadedFileContent) loadLogData(uploadedFileContent, 'custom');
        });

        // Copy command
        btnCopyCommand.addEventListener('click', async () => {
            const command = document.getElementById('git-command').textContent;
            try {
                await navigator.clipboard.writeText(command);
                btnCopyCommand.innerHTML = '<svg width="12" height="12" viewBox="0 0 24 24" fill="currentColor"><path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/></svg> Copied!';
                setTimeout(() => {
                    btnCopyCommand.innerHTML = '<svg width="12" height="12" viewBox="0 0 24 24" fill="currentColor"><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"/></svg> Copy Command';
                }, 2000);
            } catch (e) {
                showToast('Failed to copy. Please select and copy manually.', 'error');
            }
        });

        // Keyboard controls
        document.addEventListener('keydown', (e) => {
            if (e.target.tagName === 'TEXTAREA' || e.target.tagName === 'INPUT') return;

            if (rource) {
                rource.onKeyDown(e.key);
                updateUI();
                // Update labels button if L was pressed
                if (e.key === 'l' || e.key === 'L') {
                    updateLabelsButton();
                }
            }
        });

        // Mouse controls
        canvas.addEventListener('mousedown', (e) => {
            if (rource) {
                const rect = canvas.getBoundingClientRect();
                rource.onMouseDown(e.clientX - rect.left, e.clientY - rect.top);
            }
        });

        canvas.addEventListener('mouseup', () => {
            if (rource) rource.onMouseUp();
        });

        canvas.addEventListener('mousemove', (e) => {
            if (rource) {
                const rect = canvas.getBoundingClientRect();
                rource.onMouseMove(e.clientX - rect.left, e.clientY - rect.top);
            }
        });

        canvas.addEventListener('wheel', (e) => {
            if (rource) {
                e.preventDefault();
                rource.onWheel(e.deltaY);
            }
        }, { passive: false });

        // Touch controls
        let touchState = { startX: 0, startY: 0, initialDistance: 0, isPanning: false, isPinching: false };

        function getTouchDistance(touches) {
            const dx = touches[0].clientX - touches[1].clientX;
            const dy = touches[0].clientY - touches[1].clientY;
            return Math.sqrt(dx * dx + dy * dy);
        }

        canvas.addEventListener('touchstart', (e) => {
            e.preventDefault();
            const rect = canvas.getBoundingClientRect();

            if (e.touches.length === 1) {
                touchState.isPanning = true;
                touchState.startX = e.touches[0].clientX - rect.left;
                touchState.startY = e.touches[0].clientY - rect.top;
                if (rource) rource.onMouseDown(touchState.startX, touchState.startY);
            } else if (e.touches.length === 2) {
                touchState.isPanning = false;
                touchState.isPinching = true;
                touchState.initialDistance = getTouchDistance(e.touches);
                if (rource) rource.onMouseUp();
            }
        }, { passive: false });

        canvas.addEventListener('touchmove', (e) => {
            e.preventDefault();
            const rect = canvas.getBoundingClientRect();

            if (touchState.isPanning && e.touches.length === 1) {
                const x = e.touches[0].clientX - rect.left;
                const y = e.touches[0].clientY - rect.top;
                if (rource) rource.onMouseMove(x, y);
            } else if (touchState.isPinching && e.touches.length === 2) {
                const currentDistance = getTouchDistance(e.touches);
                const scaleFactor = currentDistance / touchState.initialDistance;

                if (rource && Math.abs(scaleFactor - 1.0) > 0.01) {
                    rource.zoom(scaleFactor > 1.0 ? 1.05 : 0.95);
                    touchState.initialDistance = currentDistance;
                }
            }
        }, { passive: false });

        canvas.addEventListener('touchend', (e) => {
            e.preventDefault();
            if (rource && touchState.isPanning) rource.onMouseUp();
            touchState.isPanning = false;
            touchState.isPinching = false;
        }, { passive: false });

        // Resize handler
        window.addEventListener('resize', resizeCanvas);

        // Start
        main();
    </script>
</body>
</html>
