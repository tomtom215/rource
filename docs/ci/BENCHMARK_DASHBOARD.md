# Benchmark History Dashboard

**Status**: Active
**Task ID**: CI-2
**Last Updated**: 2026-01-26

---

## Overview

The Benchmark History Dashboard provides visualization of performance metrics over time, enabling trend detection and historical comparison.

## Dashboard URL

**Production Dashboard**: `https://tomtom215.github.io/rource/dev/bench/`

The dashboard is automatically generated by `benchmark-action/github-action-benchmark` and updated on every push to `main`.

## Features

### Historical Data (90+ Days)

| Feature | Description |
|---------|-------------|
| Data Retention | Git history on gh-pages branch (indefinite) |
| Artifact Retention | 90 days for detailed reports |
| Update Frequency | Every push to main branch |
| Data Format | JSON with timestamps |

### Visualization

The dashboard provides:

1. **Time Series Charts**: Performance metrics plotted over time
2. **Benchmark Groups**: Organized by crate and benchmark suite
3. **Trend Lines**: Visual indication of performance trends
4. **Comparison View**: Compare any two points in history

### Trend Detection

| Threshold | Action |
|-----------|--------|
| > 10% regression | Alert comment on commit |
| > 20% regression | Highlighted in dashboard |
| Consistent degradation | Pattern visible in charts |

## Benchmark Suites Tracked

### Core Performance

| Suite | Crate | Description |
|-------|-------|-------------|
| scene_perf | rource-core | Scene update operations |
| barnes_hut_theta | rource-core | Physics simulation |
| easing_perf | rource-core | Animation curves |
| spatial_perf | rource-core | Spatial index operations |

### Rendering

| Suite | Crate | Description |
|-------|-------|-------------|
| blend_perf | rource-render | Alpha blending |
| bloom_perf | rource-render | Post-processing |
| texture_batching | rource-render | Draw call optimization |
| visual_perf | rource-render | Full render pipeline |

### Math Operations

| Suite | Crate | Description |
|-------|-------|-------------|
| color_perf | rource-math | Color conversions |

### VCS Parsing

| Suite | Crate | Description |
|-------|-------|-------------|
| vcs_parsing | rource-vcs | Log parser performance |

## Data Structure

### Benchmark Data (dev/bench/)

```json
[
  {
    "name": "scene_update/apply_commit",
    "unit": "ns",
    "value": 5234.5,
    "range": "± 123.4",
    "extra": "1000 iterations"
  }
]
```

### Size Metrics (dev/sizes/)

```json
[
  {"name": "Native Binary", "unit": "bytes", "value": 3845632},
  {"name": "WASM Bundle", "unit": "bytes", "value": 2156789},
  {"name": "WASM Gzipped", "unit": "bytes", "value": 287654}
]
```

## CI Workflow Integration

### Automatic Updates

The `bench.yml` workflow:

1. Runs benchmarks on push to main
2. Extracts Criterion results to JSON
3. Pushes to gh-pages branch
4. Dashboard auto-updates from data

### Alert Configuration

```yaml
alert-threshold: '110%'   # 10% regression triggers alert
comment-on-alert: true    # Post comment on commit
fail-on-alert: false      # Don't fail (CI-1 handles blocking)
```

## Accessing Historical Data

### Via GitHub API

```bash
# Get benchmark data for specific date
gh api repos/tomtom215/rource/contents/dev/bench/data.js \
  --jq '.content' | base64 -d
```

### Via Git History

```bash
# Clone gh-pages branch
git clone --branch gh-pages https://github.com/tomtom215/rource.git bench-history

# View history
cd bench-history
git log --oneline dev/bench/data.js
```

### Via Dashboard UI

1. Navigate to dashboard URL
2. Click on any data point
3. View detailed metrics and comparison

## Maintenance

### Pruning Old Data

Data pruning is not automatic. To reduce repository size:

```bash
# Clone gh-pages
git clone --branch gh-pages https://github.com/tomtom215/rource.git

# Edit data.js to remove old entries (keep 90 days)
# Commit and push
```

### Regenerating Dashboard

If dashboard is corrupted:

```bash
# Trigger manual workflow run
gh workflow run bench.yml
```

## Success Criteria Verification (CI-2)

| Criterion | Requirement | Status |
|-----------|-------------|--------|
| Historical data | 90 days of benchmark history | ✓ Git history retention |
| Visualization | Graphs of key metrics over time | ✓ benchmark-action charts |
| Trend detection | Alert on consistent degradation | ✓ 10% threshold alerts |
| Public access | Anyone can view trends | ✓ Public gh-pages URL |

---

## Related Documentation

- `docs/ci/BENCHMARK_GATES.md` - PR regression blocking (CI-1)
- `docs/performance/SLO.md` - Service Level Objectives (OP-2)
- `docs/performance/BENCHMARKS.md` - Raw benchmark data

---

*Last updated: 2026-01-26*
*Task: CI-2 Benchmark History Dashboard*
