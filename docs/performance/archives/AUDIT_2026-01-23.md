# Performance Audit Report - ARCHIVED

> **Status**: ARCHIVED - This audit was completed 2026-01-24. All actionable items were resolved.
> See [SUCCESSFUL_OPTIMIZATIONS.md](../SUCCESSFUL_OPTIMIZATIONS.md) for implemented solutions.

**Original Date**: 2026-01-23
**Closed Date**: 2026-01-24
**Test Count at Close**: 1,836 tests (now 1,899+)

---

## Status: All Actionable Items Resolved

This audit has been completed. All actionable items have been either:
- **Fixed**: Code changes applied
- **Verified Non-Issue**: Investigated and found to be false positives or already optimized
- **Won't Fix**: Architectural decisions that would require major restructuring for minimal gain

---

## Summary of Resolutions

### Critical Issues - All Resolved

| # | Issue | Resolution |
|---|-------|------------|
| 2 | `to_lowercase()` per file icon lookup | **Non-Issue**: Stack-based optimization exists |
| 5 | Vec allocation in quadtree query | **Fixed**: Uses `query_for_each()` visitor pattern |
| NEW | Visibility buffers not using `visible_entities_into()` | **Fixed**: lib.rs:1094 uses zero-alloc API |

### High Severity Issues - All Resolved

| # | Issue | Resolution |
|---|-------|------------|
| 13 | `format!` in HUD every frame | **Fixed**: Phase 24 HudCache struct |
| 14 | `path.clone()` in commit loops | **Fixed**: Uses `.as_path()` references |
| 15 | `to_lowercase()` in stats recompute | **Non-Issue**: Extensions already stored lowercase |
| 16-17 | Iterates ALL actions to count active | **Fixed**: `active_action_count` tracked incrementally |
| 19 | Barnes-Hut tree rebuilt every frame | **Fixed**: `clear()` preserves structure |
| 20 | Division per-fragment in WebGL blur | **Fixed**: `u_texel_size` pre-computed as uniform |

### Medium Severity Issues - All Resolved

| # | Issue | Resolution |
|---|-------|------------|
| 21 | HashMap allocation in `update_file_positions` | **Acceptable**: Cold path |
| 22 | Double user lookup in `spawn_action` | **Non-Issue**: Mutually exclusive paths |
| 23 | `sort_by` instead of `sort_unstable_by` | **Fixed**: Phase 26, 5 locations |
| 24-25 | Redundant entity lookups across phases | **Acceptable**: Intentional layering |
| 26 | Blocking GPU sync with channel | **Won't Fix**: Required for sync readback |
| 27 | Extra encoder creation for copy | **Won't Fix**: Standard wgpu pattern |
| 28 | Per-frame bind group for scene texture | **Cannot Fix**: Parameter varies per call |
| 29 | Division per-fragment in curve AA | **Fixed**: AA width in vertex shader |

### Low Severity - Addressed

| Category | Resolution |
|----------|------------|
| HashMap optimization | **Fixed**: Phase 26, FxHashMap in 7 files |
| Missing `#[inline]` | **Fixed**: Hot paths covered |
| Math SIMD | **Future**: Needs profiling |

---

## Optimizations Applied (Phases 1-26)

### Memory/Allocation Optimizations
- Zero-allocation visibility queries (`visible_entities_into()`)
- Zero-allocation bloom/shadow post-processing buffers
- Zero-allocation spline interpolation
- Reusable instance buffers with `clear()` + `extend()`
- HUD string caching
- Barnes-Hut tree structure preservation

### Hash Table Optimizations
- FxHashMap throughout rource-render
- FxHashMap in rource-core scene module

### Sorting Optimizations
- `sort_unstable_by` in 5 hot paths

### GPU Optimizations
- Shader warmup/precompilation
- Instance buffer sub-data updates (WebGL2)
- Uniform Buffer Objects (WebGL2)
- Cached bind groups for bloom pipeline
- GPU visibility culling infrastructure
- GPU spatial hash physics O(n)
- GPU curve tessellation

### Rendering Optimizations
- LOD culling at multiple levels
- State caching (pipeline, VAO, texture binds)
- Frustum culling via quadtree
- `sqrt()` avoided for ~78% of disc pixels

---

*Audit closed: 2026-01-24 | All actionable items resolved*
*Archived: 2026-01-25 | Superseded by performance documentation reorganization*
